\chapter{Production on several lines}
\label{chap:lot-size:several-lines}



\cref{chap:lot-size:single-line} was about to decide the optimal cycle stocks when only a single line is involved.
In this chapter, several are involved in production and we aim at deciding the part of demand assigned to each line and the cycle stocks for each each item on each line.



\section{Motivations}
\label{sec:lot-size:several-lines:motivations}


Context is almost the same than in \cref{chap:lot-size:single-line}.
A company aims at reducing it cycle stocks (which globally helps to decrease the inventory) subject to flexibility constraint of the assemblies lines.
In many applications, a company has many assembly lines and production of a single item may be done on several lines.
This kind of configuration is very common and are the consequences of multi-sourcing decisions previously made (see \cref{sec:business-context:argon:multi-sourcing} for a description of multi-sourcing issues).
These lines might be the same plants as well in different ones.
But, in both cases, it enables to increase flexibility of production and the workload between lines.


As in single line case, assembly lines are managed using $(r,\lot)$ policies or similar ones (like policies using cover).
The challenge of the multi-line case is that companies must decide the part of demand assigned to each line and the lot (or cover) used for the production of each item on each line.


In this chapter, we show how to compute the assignment of demand to lines and the lot-sizes and cover-sizes minimizing inventory subject to flexibility constraint.


\section{Problem}


The problem described by Argon Consulting considers a set $\lines$ of assembly lines producing a set $\REF$ of items over an infinite horizon.
Each line is managed using the same policy than in \cref{chap:lot-size:single-line}.
Parameters for each line $\ell$ are then the same (with an index depending on the line) and we recall them for the sake of completeness.
The internal production time of item $i$ on line $\ell$ (\ie the quantity of item $i$ produced in one time unit) is $\rate_i^{\ell}$.
Inventory $\inventory_i^\ell$ of item $i$ must satisfy demand, known in advance.
The part of demand for item $i$ assigned to line $\ell$ is modeled by a continuous decrease $\demand_i^{\ell}<\rate_i^{\ell}$ units per time unit when line $\ell$ does not produce item $i$ and a continuous increase $\rate_i^{\ell}-\demand_i^{\ell}$ units per time unit when item $i$ is produced.
The whole demand or item $i$ is modeled by a continuous decrease $\demand_i$ which is assumed positive.
Since the whole demand must satisfied, we have
\begin{equation}\label{eq:lot-size:multi-line:motivations:whole-demand}
  \sum_{\ell\in\lines}\demand_i^{\ell}=\demand_i\qquad\forall i\in\REF.
\end{equation}


If item $i$ is assigned to line $\ell$, the first time it is produced on line $\ell$ is $t_i^{\ell}$.
and the production is launched for every $t_i^{\ell}+k\cover_i^{\ell}$ where $k\in\ZZ_+$ and $\cover_i^{\ell}$ is the cover-size of item $i$ for the line $\ell$.
Each production on line $\ell$ lasts $\frac{\demand_i^{\ell}}{\rate_i^{\ell}}\cover_i^{\ell}$ in order to produce exactly the demand assign to line $\ell$ for the next $\cover_i^{\ell}$ unit of time.
(Each of these quantities is not defined if item $i$ is not assigned to line $\ell$.)
Like single-line case, the productions of several items can be placed simultaneously.


Thus, if item $i$ is assigned to line $\ell$, inventory $\inventory_i^{\ell}\bracket{t}$ generated par line $\ell$ is continuous, right and left differentiable, nonnegative and follows the dynamic
\begin{equation}\label{eq:lot-size:multi-line:motivations:dynamic}
  \dot{\inventory}_i^{\ell}\bracket{t} =
  \left\{
  \begin{array}{ll}
  \rate_i^{\ell}-\demand_i^{\ell}
  & \ds\mbox{if}\ t\in\bigcup_{k\in\ZZ_+} \left[t_i^{\ell}+k\cover_i^{\ell},t_i^{\ell}+\bracket{k+\frac{\demand_i^{\ell}}{\rate_i^{\ell}}}\cover_i^{\ell}\right),
  \\
  -\demand_i^{\ell}
  & \mbox{otherwise}.
  \end{array}
  \right.
\end{equation}


Contrary to single-line case, each line has a limited capacity.
In average over the infinite horizon, the percentage of time spend for production of all items assigned to line $\ell$ must be lower than $\capacity^{\ell}<1$ which can be written as
\begin{equation}\label{eq:lot-size:multi-line:motivations:capacity}
  \sum_{i\in\REF}\frac{\demand_i^{\ell}}{\rate_i^{\ell}}\le\capacity^{\ell}\qquad\forall \ell\in\lines.
\end{equation}
Indeed, each production of item $i$ on line $\ell$ lasts $\frac{\demand_i^{\ell}}{\rate_i^{\ell}}\cover_i^{\ell}$ (in order to produce exactly the demand for the next $\cover_i$ unit of time) and then uses $\frac{\demand_i^{\ell}}{\rate_i^{\ell}}$ percents of the production time.


Like single-line case, in average over the infinite horizon, the number of setups per unit time for all items must be lower than $\nbsetups^{\ell}$ which can be written as
\begin{equation}\label{eq:lot-size:multi-line:motivations:flexibility}
  \limsup_{\horizon\rightarrow+\infty}\ \frac{1}{\horizon} \sum_{i\in\REF^{\ell}} \left\lfloor\frac{\horizon-t_i^{\ell}}{\cover_i^{\ell}}\right\rfloor \le \nbsetups
\end{equation}
where $\REF^{\ell}$ is the set of items produced by line $\ell$.


For each item $i$, there is an initial inventory $\inventory_i\bracket{0}\in\RR_+$ given in input.


Storing one unit of item $i$ produced by line $\ell$ incurs a unit holding cost $\holding_i^{\ell}>0$ per unit time.
The objective is to find the part of demand $\demand_i^{\ell}$ for item $i$ assigned to line $\ell$ and the cover-sizes $\cover_i^{\ell}$ which minimize the average cycle stock of every lines over infinite horizon
\begin{equation}
  \limsup_{\horizon\rightarrow+\infty}\ \frac{1}{\horizon} \sum_{\ell\in\REF} \sum_{i\in\REF} \holding_i \int_0^{\horizon}\inventory_i^{\ell}\bracket{t}dt
\end{equation}
while satisfying nonnegative inventory, constraints~\eqref{eq:lot-size:multi-line:motivations:whole-demand} to \eqref{eq:lot-size:multi-line:motivations:flexibility}.

\medskip


We call this model the \emph{multi-line Economic Production Quantity model with Bounded number of Setups (multi-line EPQ-BS)}.

Like for single line case, when using lot-sizes $\lot_i^{\ell}$ instead of cover-sizes, the multi-line EPQ-BS can be simply adapt using $\lot_i^{\ell}=\demand_i^{\ell}\cover_i^{\ell}$.



\section{Bibliography}



In literature, our problem is often formulate as the decision of the assignment of production between many suppliers, the quantities ordered and the time they are ordered.
For example in model of \cite{Hong1992}, a unique item is produced by many suppliers which have not the same production costs neither the same production qualities.
They aim at minimizing the holding cost subject to upper bound on production cost and lower bound on production quality.
Their approach consists in formulating a multiple-sourcing model and solved a mathematical programming problem to obtain the optimal selection of suppliers and the size of the split orders.


More recently, \cite{Rosenblatt1998} propose a model considering one item and multiple suppliers.
Each order to a supplier follow the classic assumptions of the EOQ model but they have a constraint capacity.
They prove that the problem is $\NP$-hard but that it can be efficiently solved with dynamic programming.
\cite{Chang2006} propose an extension to adapt the model to real world constraints.
Other models, which also used ordering costs, can be found in \cite{Kim2005,Park2006}.


Another important single item model comes from \cite{Chauhan2003}.
It considers multiple suppliers delivering to one or multiple manufactures.
The main difference is that each ordering cost is a concave function of the ordered quantity which models the advantage of mono-sourcing the production.
They solved their problem with a heuristic.


The most recent model which is the closest to our can be found in \cite{Nobil2016}.
They considered a set of lines producing a set of items.
Each line is managed using classic EPQ model.
However, contrary to our case, the production of one item cannot be split between two lines.
By deciding the assignment and the cover-sizes, they aims at minimizing total cost of the inventory system, including utilization, setup, production, holding and disposal cost.




% \cite{Hong1992}
% => split production of one item between many manufacturer. The good trade-off?
% formulated a multiple-sourcing model and solved a mathematical
% programming problem to obtain the optimal selection of suppliers and the size of
% the split orders


% \cite{Rosenblatt1998}
% => one item, multiple suppliers. Each with EOQ. Constraint capacity.
% => NP-hard but efficient dynamic programming approach
% => extension to adapt to real world constraints \cite{Chang2006}


% \cite{Chauhan2003}
% => multiple supplier to deliver to one or multiple manufactures
% => each deliver is a concave function of the quantity
% => heuristic to solve
% => single item




% \cite{Park2006}
% Single item multi-line one retailer\\
% Production allocation and shipment policies in a multiple-manufacturer–single-retailer supply chain
% S. S. Park , T. Kim \& Y. Hong 

% \cite{Kim2005}
% Single item multi-line one retailer With procurement (+ NP-complete)\\
% T. Kim, Y. Hong * and J. Lee, Joint economic production allocation and ordering policies in a supply chain consisting of multiple plants and a single retailer, International Journal of Production Research, 43, 17, (3619), (2005).

% \cite{Nobil2016}
% A multi-machine multi-product EPQ problem for an imperfect manufacturing system considering utilization and allocation decisions
% Author links open overlay panelAmir HosseinNobilaAmir Hosein AfsharSedighaLeopoldo EduardoCárdenas-Barrón
% 2016
% => One item by machine (1st level). Then decide cycle length.
% minimizes total cost of the inventory system, including utilization, setup, production, holding and disposal cost





\section{Solving the multi-line EPQ-BS}


\esgil{Missing: $\NP$-hardness of the model?}



%Using the average value of the inventory of each product over time, the optimization problem can be written as follow:
We address the following alternative mathematical problem.
%We claim that the following optimization problem is a correct model of the unconstrained EPQ-BS in its unconstrained version:
\begin{subequations}\label{eq:lot-size:multi-line:unconstrained}
  \begin{align+}
  \min\quad & \ds\sum_{i\in\REF} \frac{1}{2\nbsetups^{\ell}}\bracket{\sum_{i\in\REF}\sqrt{\holding_i^{\ell}\bracket{1-\frac{\demand_i^{\ell}}{\rate_i^{\ell}}}\demand_i^{\ell}}}^2
  \label{eq:lot-size:multi-line:unconstrained:objective}
  \\
  \st\quad  & \sum_{\ell\in\lines}\demand_i^{\ell}=\demand_i && \forall i\in\REF,
  \label{eq:lot-size:multi-line:unconstrained:flexibility}
  \\
            & \sum_{i\in\REF}\frac{\demand_i^{\ell}}{\rate_i^{\ell}}\le\capacity^{\ell} && \forall \ell\in\lines,
  \label{eq:lot-size:multi-line:unconstrained:capacity}
  \\
            & \demand_i^{\ell} \ge 0 && \forall i\in\REF.
  \label{eq:lot-size:multi-line:unconstrained:positivity}
  \end{align+}
\end{subequations}


\begin{thm}\label{thm:lot-size:multi-line:unconstrained:optimality}
Optimal solutions of Problem~\eqref{eq:lot-size:multi-line:unconstrained} can be found on the extreme point of the constraints polyhedron using an algorithm minimizing concave function on a polyhedron.

Moreover, an optimal solution $\bracket{\demand_i^{\ell*}}_{i\in\REF,\ell\in\lines}$ of Problem~\eqref{eq:lot-size:multi-line:unconstrained} can be completed in an optimal solution of multi-line EPQ-BS setting for each item $i$ assigned to line $\ell$
\begin{equation}\label{eq:lot-size:multi-line:unconstrained:optimal-cover}
  \cover_i^{\ell*}= \frac{\sum_{j\in\REF}\sqrt{\holding_j\bracket{1-\frac{\demand_i^{\ell*}}{\rate_i}}\demand_i^{\ell*}}}{\nbsetups\sqrt{\holding_i\bracket{1-\frac{\demand_i^{\ell*}}{\rate_i}}\demand_i^{\ell*}}}.
\end{equation}
\end{thm}


Minimization of concave function over a polyhedron is $\NP$-hard since it contains Zero-One Integer Programming (see \cite{Raghavachari1969}) which is known to be $\NP$-hard (see \cite{Garey1979}).
However, there are many algorithms to solve this kind of problem (see \cite{Tuy1964} for the first proposed algorithm and \cite{Benson1998} for a review) and it is well know that an optimal solution can be found in an extreme point of the constraints polyhedron (see \cite{Benson1985}).


Note that \cref{eq:lot-size:multi-line:unconstrained:optimal-cover} is well-defined.
Indeed, $\capacity^{\ell}$ is lower than 1.
Thus, constraint~\eqref{eq:lot-size:multi-line:unconstrained:capacity} and definition of the cover-sizes only for the items assigned to a line ensure that $\bracket{1-\frac{\demand_i^{\ell*}}{\rate_i}}\demand_i^{\ell*}>0$.


We recall the concave monotone superposition of a convex vector-function by a monotone convex function.


\begin{lem}[``Concave monotone superposition'']\label{lem:concave-monotone-superposition}
Let $C$ be a convex subset of $\RR^n$.
Let $f:x\in C \mapsto f(x) = \bracket{f_1(x),\ldots,f_k(x)}$ be vector-function on $C\subseteq\RR^n$ with concave components $f_i$, and assume that $F$ is a concave function on $\RR^k$ which is monotone, \ie such that $z\le z'$ implies that $F(z)\le F(z')$.
Then the superposition $\phi(x) = F\bracket{f(x)}=F\bracket{f_1(x),\ldots,f_k(x)}$ is concave on $C$.
\end{lem}


\begin{proof}
Let $x$ and $x'$ be two vectors of $C$ and let $\lambda$ be a real number in $(0,1)$.
Since each $f_i$ is concave, we have
$f\bracket{\lambda x +(1-\lambda) x'} \ge \lambda f(x) + (1-\lambda) f(x')$.
And then,
\begin{subequations}
\begin{align}
  F\bracket{f\bracket{\lambda x +(1-\lambda) x'}}
  &\ge F\bracket{\lambda f(x) + (1-\lambda) f(x')}
  && \mbox{(monotonicity of $F$)}
  \\
  &\ge \lambda F\bracket{f(x)} + (1-\lambda) F\bracket{f(x')}.
  && \mbox{(concavity of $F$)}
\end{align}
\end{subequations}
Finally $\phi\bracket{\lambda x +(1-\lambda) x'} \ge \lambda \phi(x) + (1-\lambda) \phi(x')$ and $\phi$ is concave on $C$.
\end{proof}



\begin{lem}\label{lem:concave-objective-function}
The objective function
\begin{equation}
\begin{array}{rccl}
  g: & \ds\bigcup_{\ell\in\lines}\bigcup_{i\in\REF} \sqbracket{0,\rate_i^{\ell}} & \to & \RR_+ \\
     & \bracket{\demand_i^{\ell}}_{i,\ell} & \mapsto & \ds\sum_{i\in\REF} \frac{1}{2\nbsetups^{\ell}}\bracket{\sum_{i\in\REF}\sqrt{\holding_i^{\ell}\bracket{1-\frac{\demand_i^{\ell}}{\rate_i^{\ell}}}\demand_i^{\ell}}}^2
\end{array}
\end{equation}
of Problem~\eqref{eq:lot-size:multi-line:unconstrained} is concave.
\end{lem}


\begin{proof}%[Proof of \cref{thm:lot-size:multi-line:unconstrained:optimality}]
%Set of constraints defines a compact polyhedron.
%We now prove the concavity of the objective function.
Let $F: x\in\RR_+^{\REF} \mapsto \bracket{\sum_{i\in\REF} \sqrt{x_i}}^2 \in \RR_+$ be a function on $\RR_+^{\REF}$.
$F$ is continuous on $\RR_+^{\REF}$ and differentiable on $(\RR_+^*)^{\REF}$ and we have for all $x$ and $y$ in $(\RR_+^*)^{\REF}$
\begin{equation}
  \nabla F(x) = \sqrt{F(x)}\bracket{\sqrt{x_1},\ldots,\sqrt{x_{\REF}}}
\end{equation}
and
\begin{multline}
\left<\nabla F(y)-\nabla F(x),y-x\right>
\\
=
-\frac{1}{2}\sum_{i\in\REF}\sum_{j\in\REF}
\sqbracket
{
  \bracket{ \sqrt[4]{\frac{y_i}{y_j}}\sqrt{x_j} - \sqrt[4]{\frac{y_j}{y_i}}\sqrt{x_i} }^2
  +
  \bracket{ \sqrt[4]{\frac{x_i}{x_j}}\sqrt{y_j} - \sqrt[4]{\frac{x_j}{x_i}}\sqrt{y_i} }^2
}
\le 0
\end{multline}
Thus, $F$ is concave on $(\RR_+^*)^{\REF}$.
Since $F$ is continuous on $\RR_+^{\REF}$, $F$ is concave on $\RR_+^{\REF}$.
For each $x$ and $x'$ in $\RR_+^{\REF}$, $x\le x'$ implies that $F(x)\le F(x')$.
Using \cref{lem:concave-monotone-superposition} with $f_i^{\ell}:\demand_i^{\ell}\in\sqbracket{0,\rate_i^{\ell}}\to\holding_i^{\ell}\bracket{1-\frac{\demand_i^{\ell}}{\rate_i^{\ell}}}\demand_i^{\ell}$, we have than 
\begin{equation}
\begin{array}{rccl}
  g^{\ell}: & \sqbracket{0,\rate_1^{\ell}}\times\ldots\times\sqbracket{0,\rate_1^{\ell}} & \to     & \RR_+ \\
            & \bracket{\demand_1^{\ell},\ldots,\demand_{\REF}^{\ell}} & \mapsto & \bracket{\sum_{i\in\REF}\sqrt{\holding_i^{\ell}\bracket{1-\frac{\demand_i^{\ell}}{\rate_i}}\demand_i^{\ell}}}^2
\end{array}
\end{equation}
is concave for each line $\ell\in\lines$.
Thus the objective function $g$ of Problem~\eqref{eq:lot-size:multi-line:unconstrained} is concave as linear combination with nonnegative coefficients of concave functions.
\end{proof}


\begin{proof}[Proof of \cref{thm:lot-size:multi-line:unconstrained:optimality}]
Let $\bracket{\demand_i^{\ell}}_{i,\ell}$ be a feasible solution of Problem~\eqref{eq:lot-size:multi-line:unconstrained}.
Consider a line $\ell\in\lines$ and the set $\REF^{\ell}$ of the items assigned to $\ell$.
According to \cref{thm:lot-size:single-line:deterministic:unconstrained:optimality}, the covers which minimize the average holding cost over infinite horizon and satisfy nonnegative inventory constraint~\eqref{eq:lot-size:multi-line:motivations:dynamic} and constraint~\eqref{eq:lot-size:multi-line:motivations:flexibility} are given by \cref{eq:lot-size:multi-line:unconstrained:optimal-cover} and the corresponding cost is equal to
\begin{equation}\label{eq:lot-size:multi-line:unconstrained:optimality:cost}
  \frac{1}{2\nbsetups}\bracket{\sum_{i\in\REF^{\ell}}\sqrt{\holding_i^{\ell}\bracket{1-\frac{\demand_i^{\ell}}{\rate_i^{\ell}}}\demand_i^{\ell}}}^2.
\end{equation}
Indexes in sum expressing holding costs~\eqref{eq:lot-size:multi-line:unconstrained:optimality:cost} can be extend to $\REF$ (since assigned demand is equal to zero).
Thus, a feasible solution of Problem~\eqref{eq:lot-size:multi-line:unconstrained} can be completed in a feasible solution of multi-line EPQ-BS with same cost.


Conversely, let $\bracket{\demand_i^{\ell},\cover_i^{\ell}}_{i,\ell}$ be a feasible solution of multi-line EPQ-BS.
It is clearly feasible for Problem~\eqref{eq:lot-size:multi-line:unconstrained}.
According to \cref{thm:lot-size:single-line:deterministic:unconstrained:optimality}, for each line $\ell$, average holding cost over infinite horizon is greater or equal to \eqref{eq:lot-size:multi-line:unconstrained:optimality:cost}.
Thus, a feasible solution of multi-line EPQ-BS can be completed in a feasible solution of Problem~\eqref{eq:lot-size:multi-line:unconstrained} whose cost is greater or equal to \eqref{eq:lot-size:multi-line:unconstrained:optimality:cost}.


Finally, thanks to \cref{lem:concave-objective-function}, an optimal solution $\bracket{\demand_i^{\ell*}}_{i,\ell}$ of Problem~\eqref{eq:lot-size:multi-line:unconstrained} can be found minimizing a concave function over a polyhedron.
Then, an optimal solution of multi-line EPQ-BS can be found from $\bracket{\demand_i^{\ell*}}_{i,\ell}$ setting $\bracket{\cover_i^{\ell*}}_{i,\ell}$ as in \cref{eq:lot-size:multi-line:unconstrained:optimal-cover}.
\end{proof}

