\chapter{Deterministic CLSP-BS}
\label{chap:PDP:deterministic}


\section{Motivations}
\label{sec:PDP:deterministic:Motivations}

Fixing the production level for the forthcoming period is a basic decision to be taken when managing an assembly line. Usually, a demand has to be satisfied at due dates but the limited capacity of the line prevents last minute production. On the other hand, too early productions may lead to unnecessary high inventory costs. The challenge of this kind of problems, known as {\em lot-sizing problems} in the operational research community, consists in finding a trade-off between demand satisfaction and holding costs.
When several items can be produced on a same line -- the so-called {\em multi-item} lot-sizing problem --, the capacity of the assembly line is often all the more reduced as the number of distinct items produced over the current period is high. Indeed, changing an item in production stops the line for a moment. This additional capacity reduction is usually modeled by setup costs contributing to the total cost.


Within the partnership with Argon Consulting, a non-standard feature of the problem arose. The capacity reduction due to production setups is not modeled by setup costs but instead by an explicit upper bound on the total number of items that can be produced over a period. According to Argon Consulting, many clients aim at minimizing mainly their inventory costs while keeping the number of distinct items produced over each periods below some threshold. This is essentially because, contrary to inventory costs, setup costs are hard to quantify and a maximal number of possible setups per period is easy to estimate.


To the best of our knowledge, the problem addressed in this chapter is original and such a bound on the number of distinct items produced over a period has not been considered by academics yet, with the notable exception of \cite{Rubaszewski2011} but, contrary to our problem, their bound is an overall bound for the whole horizon and they still consider setup costs.


\medskip

The problem considers an assembly line producing a set $\REF$ of items over $\horizon$ periods. The number of distinct items produced over a period $t$ cannot exceed $\nbsetups_t>0$. There is also an upper bound $\capacity_t$ on the total period production (summed over all items) and an upper bound $\capacity_t^i$ on the production of item $i$ at period $t$. The capacity needed (in time units) to produce one unit of $i$ in period $t$ is $\rate_t^i$.

The production of item $i$ must satisfy a demand $\demand_t^i$ at the end of period $t$. When production of a item $i$ is not used to satisfy the demand, it can be stored but incurs a unit holding cost $\holding_t^i>0$ per period. Note that there is no setup cost, as discussed in section~\ref{sec:PDP:Motivations}. For each item $i$, there is an initial inventory $s_0^i\in\mathbb{R}_+$.

The goal is to satisfy the whole demand at minimum cost.

Since this problem is a variation of the \emph{Capacitated Lot-Sizing Problem (CLSP)} with a new flexibility constraint expressed as an upper bound on the number of setups, we call our formulation the \emph{Capacitated Lot-Sizing Problem with Bounded number of Setups (CLSP-BS)}.

In many of our applications, holding costs $\holding_t^i$ and internal production times $\rate_t^i$ does not depend on the period and the upper bounds $\capacity_t^i$ and $\capacity_t$ and the maximal number $\nbsetups_t$ of setups does not depend on the item nor the period. Then, we get a simplest version called the \emph{Uniform Capacitated Lot-Sizing Problem with Bounded number of Setups (Uniform CLSP-BS)}. This formulation captures the essential part and the difficulty of the problem namely the limited flexibility of the assembly line. Most results are true for the CLPS-BS, but we will give counterexample when results only stand for the Uniform CLSP-BS.


\esgil{Supposer $\rate_t^i>0$ ? Où le mettre dans la rédaction ? (Utile pour les preuves)}


\section{Bibliography}


While there are many variations of lot-sizing problems in industry, they often minimize a combination of holding costs, production costs and setup costs.
However, production can concern a single or many items and be made on single or several assembly lines.
It can be constrained by capacity or setup time.
Backlog, safety stock, minimal productivity, setup times can be considered.
Review of models are abundant and can be found in \cite{Geunes2014} for single-item models, in \cite{Gicquel2008} for multi-item models or in \cite{Karimi2003} for both models. A proposition of classification of lot-sizing models can be found in~\cite[Chapter 4 and 12]{Pochet2006}.

We do not propose a complete review of the models and only consider some seminal model on a single assembly line.

\medskip

First model was proposed by \cite{Wagner1958}. It is a uncapacitated, single-item model over and $\horizon$ periods. The demand $\demand_t$ is dynamic (\ie time-dependent) and storage is possible between periods. The goal is to minimize holding and setup costs. This model was solved in polynomial time.
Its generalization with production cost (proportional to the quantity produced) depending on period is called \emph{Uncapacitated Economic Lot-Sizing Problem (UELSP)} and was solved in polynomial time \cite{Federgruen1991,Wagelmans1992,Aggarwal1993}.


The \emph{Capacitated Economic Lot-Sizing Problem (CELSP)} is the same model with capacities depending on time. It is one of the simplest lot-sizing problem which is \NP-hard \cite{Florian1980} but have a fully polynomial approximation schemes \cite{vanHoesel2001}.

\medskip

In many applications, a line can produce more than one item. Two sub-classes are often consider big bucket models and small bucket models.
In big bucket models, many items can be produced during a period.
The \emph{Capacitated Lot-Sizing Problem (CLSP)} is a natural multi-item extension of the CELSP and therefore is \NP-complete.
In small bucket model, only one item can be produced during a period. It is called \emph{continuous} when production can be a fractional part of capacity and \emph{discrete} when production must be done at full capacity. The \emph{Capacitated Setup Lot-sizing Problem (CSLP)} is an example of continuous small bucket model and \emph{Discrete Lot sizing and Scheduling problem (DLSP)} an example of discrete one.

\medskip

An other way of modeling flexibility and not used setup costs is constraints on the capacity lost due to setups like in the Kellogg's case in \cite[Chapter 4]{Pochet2006}. Some lot-sizing and scheduling problems (see for example \cite{Guimaraes2014}) also model sequence dependent capacity reduction but keep setup costs.



%Lot-sizing problems are a well-studied topic, with many variations (deterministic/stochastic, single/multi item, capacitated/uncapacitated, etc.). Recent surveys have been proposed: see \cite{Gicquel2008,quadt2008capacitated} for the deterministic version and \cite{Mula2006,Aloulou2014,Diaz-Madronero2014} for the stochastic version.

\medskip

\vlil{Annonce du plan du chapitre}

According to Argon, capacity reduction constraints are not easy to parametrize in practice at mid-term level since they rely on scheduling which are short-term decisions. Thus, in the follow-up to this chapter, we propose a new model for the flexibility introducing a bounded number of setups per period and show the \NP-completeness and the theoretical difficulties of the model.



\section{Model formulation}


In order to solve the CLSP-BS, we introduce the following decision variables. The quantity of item $i$ produced at period $t$ is denoted by $\quantity_t^i$ and the inventory at the end of the period is denoted by $\inventory_t^i$. We also introduce a binary variable $\setup_t^i$ which takes the value 1 if the item $i$ is produced during period $t$.

The lot-sizing problem can be written as:
\begin{subequations}\label{eq:CLSP-BS}
  \begin{align}
    \min\quad & \rlap{$\ds \sum_{t=1}^{\horizon} \sum_{i\in\REF} \holding_t^i \inventory_t^i$}
    \label{eq:CLSP-BS:objective}
    \\
    \st\quad & \ds \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:CLSP-BS:inventory-dynamic}
    \\
    & \ds \sum_{i\in\REF} \rate_t^i \quantity_t^i \le \capacity_t && \forall t\in\range{\horizon},
    \label{eq:CLSP-BS:capacity}
    \\
    & \ds \rate_t^i \quantity_t^i \le \capacity_t^i \setup_t^i && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:CLSP-BS:big-M}
    \\
    & \ds \sum_{i\in\REF} \setup_t^i \le \nbsetups_t && \forall t\in\range{\horizon},
    \label{eq:CLSP-BS:setups}
    \\
    & \ds \setup_t^i \in \crbracket{0,1} && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:CLSP-BS:boolean}
    \\
    & \ds \quantity_t^i,\ \inventory_t^i \ge 0 && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:CLSP-BS:positivity}
  \end{align}
\end{subequations}

Constraint~\eqref{eq:CLSP-BS:inventory-dynamic} is the inventory dynamic.
Constraint~\eqref{eq:CLSP-BS:capacity} prevents from exceeding the capacity of the assembly line.
Constraint~\eqref{eq:CLSP-BS:big-M} is both a ``big-M'' constraint and a capacity of the production of a single item.
Constraint~\eqref{eq:CLSP-BS:setups} limits the number of setups at each period.
Note that without loss of generality, we can suppose that $\capacity_t^i \le \capacity_t$ for each period $t$ and each item $i$.


\medskip

In the uniform case, holding costs $\holding_t^i$ and internal production times $\rate_t^i$ of item $i$ do not depend on time and is equal to $\rate^i$ and production capacities $\capacity_t^i$ and $\capacity_t$ depend neither on time nor on item and is equal to $\capacity>0$.
Then, we normalize production variables setting $\widehat{\quantity}_t^i=\frac{\rate^i\quantity_t^i}{\capacity}$ and replace accordingly the other variables and parameters setting $\widehat{\inventory}_t^i=\frac{\rate^i\inventory_t^i}{\capacity}$, $\widehat{\demand}_t^i=\frac{\rate^i\demand_t^i}{\capacity}$ and $\widehat{\holding}^i=\frac{\capacity\holding^i}{\rate^i}$.
For the purpose of notation, the circumflex accent is omitted and the optimization problem can be written as:

\begin{subequations}\label{eq:Uniform-CLSP-BS}
  \begin{align}
    \min\quad & \rlap{$\ds \sum_{t=1}^{\horizon} \sum_{i\in\REF} \holding^i \inventory_t^i$}
    \label{eq:Uniform-CLSP-BS:objective}
    \\
    \st\quad & \ds \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:Uniform-CLSP-BS:stock-dynamics}
    \\
    & \ds \sum_{i\in\REF} \quantity_t^i \le 1 && \forall t\in\range{\horizon},
    \label{eq:Uniform-CLSP-BS:capacity}
    \\
    & \ds \quantity_t^i \le \setup_t^i && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:Uniform-CLSP-BS:item-capacity}
    \\
    & \ds \sum_{i\in\REF} \setup_t^i \le \nbsetups && \forall t\in\range{\horizon},
    \label{eq:Uniform-CLSP-BS:setups}
    \\
    & \ds \setup_t^i \in \crbracket{0,1} && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:Uniform-CLSP-BS:boolean}
    \\
    & \ds \quantity_t^i,\ \inventory_t^i \ge 0 && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:Uniform-CLSP-BS:positivity}
  \end{align}
\end{subequations}


\section{Theoretical results}
\label{sec:PDP:deterministic:theoretical-results}


\subsection{\NP-completeness}


\begin{thm}
  The Uniform CLSP-BS is \NP-complete in the strong sense, even if every holding costs $\holding^i$ is unitary or every holding cost is null.
\end{thm}


%In order to prove the \NP-completeness of the Uniform CLSP-BS, we first prove the \NP-completeness of the CLSP-BS in proposition~\ref{prop:CLSP-BS:NP-complete}.

%\begin{prop}\label{prop:CLSP-BS:NP-complete}
%  The CLSP-BS is \NP-complete in the strong sense, even if holding costs $\holding_t^i$ and internal production times $\rate_t^i$ are unitary and if capacities and number of setup do not depend on time nor items.
%\end{prop}


Reducing 3-partition problem to the Uniform CLSP-BS, we show that Uniform CLSP-BS is \NP-complete. We remind that 3-partition problem is to decide whether a given multiset of integers can be partitioned into triples that all have the same sum. This problem is known to be \NP-complete in the strong sense (see~\cite{Garey1979}).



\begin{proof}
Let $\crbracket{a_1,\ldots,a_{3m}}$ an instance of 3-partition problem. (We can suppose that at least one $a_i$ is not null.)

$m$ is the number $\horizon$ of periods.
The indexes $\crbracket{1,\ldots,3m}$ are the indexes of the items $i\in\REF$.
$\frac{m\,a_i}{\sum_{j=1}^{3m}a_j}$ is the demand $\demand_{\horizon}^i$ of the item $i$ at the period $\horizon$. Every other demand is null.
%$B=\frac{1}{m}\sum_{i=1}^{3m}a_i$ is the capacity $\capacity_t$ at each period $t$ and the capacity $\capacity_t^i$ for each item at each period and
3 is the number $\nbsetups$ of setups at each periods.
Every holding cost $\holding^i$ is unitary (or every holding cost is null).

Thus, we have a solution for 3-partition problem if and only if we can face the demand at the period $\horizon$. Since 3-partition is \NP-complete in the strong sense, CLSP-BS is NP-complete.
\end{proof}


Since Uniform CLSP-BS is a special case of CLSP-BS, CLSP is also \NP-complete. However, complexity of the following cases is still an open problem:
\begin{itemize}
\item Uniform CLSP-BS with $\nbsetups=1$ or $\nbsetups=2$.
\item Uncapacitated CLSP-BS that a version of CLSP-BS without capacity constraint~\eqref{eq:CLSP-BS:capacity} and with $\capacity_t^i\ge\sum_{\tau\in\range{\horizon}}\demand_{\tau}^i$, for each period $t$ and each item $i$.
\esgil{Polynomial en Uniform CLSP-BS?}
\end{itemize}



\subsection{Relaxations}

\subsubsection{Continuous relaxation}

The goal of this section is to show that unless the weekly capacity production of one item is lower than the weekly capacity production of the line, continuous relaxation is not a good approach to solve the CLSP-BS

\begin{prop}\label{prop:relaxation-independant-N}
If for each item $i$, $\capacity_t^i\ge\capacity_t$ for all period $t\in\range{\horizon}$ and if for each period $t\in\range{\horizon}$, $\nbsetups_t=0\implies\capacity_t=0$, then the continuous relaxation of CLSP-BS does not depend on $\nbsetups$.
\end{prop}

The immediate corollary of this proposition is that the continuous relaxation of Uniform CLSP-BS never depends on $\nbsetups$.


The following example shows that the hypothesis $\capacity_t^i=\capacity_t,\ \forall t\in\range{\horizon},\ \forall i\in\REF$ is the minimal one for the proposition. Lets consider an instance of CLSP-BS  with two periods and two items where the holding costs at the end of the first period are $h$ for the two items and 0 at the end of the second period. The assembly line's capacity is $\capacity_t=2$ at each period and the capacity per item at each period is $\capacity_t^i=1$. The number of setups per period is $\nbsetups_t=1$ and the demand is null for the first period and 1 for each reference at the second period. All others parameters are unitary. Then, the optimal solution of the continuous relaxation of CLSP-BS is $h$ whereas the optimal solution of the continuous relaxation of CLSP-BS without the flexibility constraint~\eqref{eq:CLSP-BS:setups} is 0.

\esgil{Add figure representing the example}

We now prove the proposition \ref{prop:relaxation-independant-N}.

\begin{proof}
Lets consider an instance of CLSP-BS where for each item $i\in\REF$, $\capacity_t^i\ge\capacity_t$ for all $t\in\range{\horizon}$.

Let $v$ denotes the optimal value of the continuous relaxation of the CLSP-BS and $\widehat{v}$ the optimal value of the continuous relaxation of CLSP-BS without the flexibility constraint~\eqref{eq:CLSP-BS:setups}. Obviously, we have $v \ge \widehat{v}$. Let us show that $v \le \widehat{v}$.

Let $\bracket{\widehat{\setup}_t^i, \widehat{\quantity}_t^i, \widehat{\inventory}_t^i}_{t\in\range{\horizon},i\in\REF}$ be a feasible solution of the continuous relaxation of CLSP-BS without the flexibility constraint~\eqref{eq:CLSP-BS:setups}.
For each $t\in\range{\horizon}$ and each $i\in\REF$, we define
$\setup_t^i=\frac{\rate_t^i\,\widehat{\quantity}_t^i}{\capacity_t^i}$ if $\capacity_t^i>0$ and $\setup_t^i=0$ otherwise, $\quantity_t^i=\widehat{\quantity}_t^i$ and $\inventory_t^i=\widehat{\inventory}_t^i$. We now prove that $\bracket{\setup_t^i, \quantity_t^i, \inventory_t^i}_{t\in\range{\horizon},i\in\REF}$ is a feasible solution of the continuous relaxation of CLSP-BS.

By definition of $\quantity_t^i$ and $\inventory_t^i$, constraints~\eqref{eq:CLSP-BS:inventory-dynamic} and \eqref{eq:CLSP-BS:capacity} of CLSP-BS are satisfied.

If $\capacity_t=0$, since $\bracket{\widehat{\setup}_t^i, \widehat{\quantity}_t^i, \widehat{\inventory}_t^i}_{t\in\range{\horizon},i\in\REF}$ is feasible, we have $\widehat{\quantity}_t^i=0$ and constraint~\eqref{eq:CLSP-BS:big-M} is satisfied. If $\capacity_t>0$, by definition of $\setup_t^i$ and $\quantity_t^i$ constraint~\eqref{eq:CLSP-BS:big-M} of CLSP-BS is satisfied.

Using in this order $\capacity_t^i\ge\capacity_t$, the definition of $\setup_t^i$ and the feasibility of $\bracket{\widehat{\setup}_t^i, \widehat{\quantity}_t^i, \widehat{\inventory}_t^i}_{t\in\range{\horizon},i\in\REF}$, we have:
$$
\capacity_t\sum_{i\in\REF}\setup_t^i
\le
\sum_{i\in\REF}\capacity_t^i\setup_t^i
=
\sum_{i\in\REF}\rate_t^i\widehat{\quantity}_t^i
\le
\capacity_t
$$
If $\capacity_t>0$, then $\sum_{i\in\REF}\setup_t^i\le 1\le\nbsetups_t$. Otherwise, if $\capacity_t=0$ since $\bracket{\widehat{\setup}_t^i, \widehat{\quantity}_t^i, \widehat{\inventory}_t^i}_{t\in\range{\horizon},i\in\REF}$, we have $\quantity_t^i=0$ for each item $i$ and by definition of $\setup_t^i$, $\sum_{i\in\REF}\setup_t^i=0\le\nbsetups_t$. In both cases, flexibility constraint~\eqref{eq:CLSP-BS:setups} of CLSP-BS is satisfied.

Finally, if $\capacity_t^i=0$, by definition $\setup_t^i=0$. Otherwise, $\setup_t^i=\frac{\rate_t^i\widehat{\quantity}_t^i}{\capacity_t^i}\le\widehat{\setup}_t^i\le 1$. In both cases, continuous relaxation of constraint~\eqref{eq:CLSP-BS:boolean} of CLSP-BS is satisfied.

Thus, we get a feasible solution of the continuous relaxation of CLSP-BS. So $v \le \widehat{v}$.
\end{proof}



\subsubsection{Lagrangian relaxations}


The two Lagrangian relaxations described in this section are quite the same for the CLSP-BS and the Uniform CLSP-BS. Thus, for the sake of simplicity, we write them for the Uniform CLSP-BS.


A first option consists in dualizing the capacity constraint~\eqref{eq:Uniform-CLSP-BS:item-capacity}. Then, for all $\lambda = \bracket{\lambda_t^i}_{t\in\range{\horizon},\,i\in\REF}\ge 0$, we have:
\begin{subequations}
  \begin{align}
    \cG_1\bracket{\lambda} &= 
    \left\{
      \begin{array}{rll}
        \min & \multicolumn{2}{l}{\sum_{t=1}^{\horizon} \sum_{i\in\REF} \sqbracket{ \holding^i\inventory_t^i + \lambda_t^i \bracket{\quantity_t^i - \setup_t^i} } } \\
        \st & \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i & \forall t,r \\
        & \sum_{i\in\REF} \quantity_t^i \le 1 & \forall t \\
        & \sum_{i\in\REF} \setup_t^i \le \nbsetups & \forall t \\
        & \setup_t^i \in \crbracket{0,1} & \forall t,r \\
        & \quantity_t^i,\ \inventory_t^i \ge 0 & \forall t,r
      \end{array}
    \right.
    \\
    &= 
    \left\{
      \begin{array}{rll}
        \min & \multicolumn{2}{l}{\sum_{t=1}^{\horizon} \sum_{i\in\REF} \bracket{ \holding^i\inventory_t^i + \lambda_t^i \quantity_t^i } } \\
        \st & \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i & \forall t,r \\
        & \sum_{i\in\REF} \quantity_t^i \le 1 & \forall t \\
        & \quantity_t^i,\ \inventory_t^i \ge 0 & \forall t,r
      \end{array}
    \right.
    +
    \left\{
      \begin{array}{rll}
        \max & \multicolumn{2}{l}{\sum_{t=1}^{\horizon} \sum_{i\in\REF} \lambda_t^i\setup_t^i } \\
        \st & \sum_{i\in\REF} \setup_t^i \le \nbsetups & \forall t \\
        & \setup_t^i \in \crbracket{0,1} & \forall t,r
      \end{array}
    \right.
    \\
    &= 
    \left\{
      \begin{array}{rll}
        \min & \multicolumn{2}{l}{\sum_{t=1}^{\horizon} \sum_{i\in\REF} \bracket{ \holding^i \inventory_t^i + \lambda_t^i \quantity_t^i } } \\
        \st & \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i & \forall t,r \\
        & \sum_{i\in\REF} \quantity_t^i \le 1 & \forall t \\
        & \quantity_t^i,\ \inventory_t^i \ge 0 & \forall t,r
      \end{array}
    \right.
    +
    \sum_{t=1}^{\horizon}
    \left\{
      \begin{array}{rll}
        \max & \multicolumn{2}{l}{\sum_{i\in\REF} \lambda_t^i \setup_t^i } \\
        \st & \sum_{i\in\REF} \setup_t^i \le \nbsetups \\
        & \setup_t^i \in \crbracket{0,1} & \forall r
      \end{array}
    \right.\label{eq:Lagrangian:capacity:max-setups}
  \end{align}
\end{subequations}

The minimization program of the equation~\eqref{eq:Lagrangian:capacity:max-setups} is a linear program with only continuous variables. So it can be solved in polynomial time. For each $t\in\range{\horizon}$, the maximization program can be solve in polynomial time with a greedy algorithm by sorting the $\lambda_t^i$ in decreasing order. Thus, this Lagrangian relaxation is easy to solve and moreover, it yield an integer solution.

\medskip

A second option consists in using the pseudo-norm
$$
\begin{array}{lrcl}
  \norm{\ .\ }_0 :& \RR^n & \longrightarrow & \RR_+ \\
  & x & \longmapsto & \sum_{i=1}^n \findi{\crbracket{x_i \ne 0}}
\end{array}
$$
which returns the size of the support of the vector $x$ and in dualizing the flexibility constraint~\eqref{eq:Uniform-CLSP-BS:setups}. Then, for all $\mu=\bracket{\mu_t}_{t\in\range{\horizon}}\ge 0$, we have:
\begin{equation}
  \begin{aligned}
    \cG_2\bracket{\mu} &= 
    \left\{
      \begin{array}{rll}
        \min & \multicolumn{2}{l}{\sum_{t=1}^{\horizon} \sqbracket{ \sum_{i\in\REF} \holding^i \inventory_t^i + \mu_t \bracket{ \norm{\bracket{\quantity_t^i}_{i\in\REF}}_0 - \nbsetups} } } \\
        \st & \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i & \forall t,r \\
        & \sum_{i\in\REF} \quantity_t^i \le 1 & \forall t \\
        & \quantity_t^i \le 1 & \forall t,r \\
        & \quantity_t^i,\ \inventory_t^i \ge 0 & \forall t,r
      \end{array}
    \right.
  \end{aligned}
  \label{eq:Lagrangian:setups}
\end{equation}

Because of $\norm{\ .\ }_0$ being a pseudo-norm, it is common to replace it with $\norm{\ .\ }_1$ and in this case, the equation~\eqref{eq:Lagrangian:setups} can easily be turned into a linear program with continuous variables.


\esgil{Intérêt de cette partie ?}


\subsection{Valid inequality}

\esgil{suppression de cette partie. L'inégalité valide trouvée existait déjà dans \cite{Geunes2014}}




\subsection{Extended formulations}


In order to find bounds on the CLSP, we propose two extended formulations. Unfortunately, their continuous relaxations are equal to the one of the CLSP. The goal of this section is to prove these results. Since the proof is not easy, we write it for the CLSP.



\subsubsection{Model formulations}

The first extended formulation is given by the program~\eqref{eq:extended-CLSP:periods}. For each period $t$, we introduce a set of indexes $\crbracket{p\in{\REF\choose\nbsetups_t}}$ which represents every choice of $\nbsetups_t$ items among $\REF$. We use binary variables $y_t^p$ defined for each $t\in\range{\horizon}$ and each $p\in{\REF\choose\nbsetups_t}$ in place of setups variables $\setup_t^i$. $y_t^p$ is equal to 1 if items in $p$ are produced at periods $t$.

\begin{subequations}\label{eq:extended-CLSP:periods}
  \begin{align}
    \min\quad & \rlap{$\ds \sum_{t=1}^{\horizon} \sum_{i\in\REF} \holding_t^i \inventory_t^i$}
    \label{eq:extended-CLSP:periods:objective}
    \\
    \st\quad & \ds \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:extended-CLSP:periods:inventory-dynamic}
    \\
    & \ds \sum_{i\in\REF} \rate_t^i \quantity_t^i \le \capacity_t && \forall t\in\range{\horizon},
    \label{eq:extended-CLSP:periods:capacity}
    \\
    & \ds \rate_t^i \quantity_t^i \le \capacity_t^i \sum_{p\in{\REF\choose\nbsetups_t}~|~i\in p} y_t^p && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:extended-CLSP:periods:item-capacity}
    \\
    & \ds \sum_{p\in{\REF\choose\nbsetups_t}} y_t^p \le 1 && \forall t\in\range{\horizon},
    \label{eq:extended-CLSP:periods:unique-pattern}
    \\
    & \ds y_t^p \in \NN && \forall t\in\range{\horizon},\ p\in{\REF\choose\nbsetups_t},
    \label{eq:extended-CLSP:periods:pattern-def}
    \\
    & \ds \quantity_t^i,\ \inventory_t^i \ge 0 && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:extended-CLSP:periods:positivity}
  \end{align}
\end{subequations}


The second extended formulation is given by the program~\eqref{eq:extended-CLSP:items}. For each item $i$, we introduce a set of indexes $\crbracket{\ell\subseteq\range{\horizon}}$ which represents every choice of periods when item $i$ is produced. We use binary variables $z_{\ell}^i$ defined for each $i\in\REF$ and each $\ell\subseteq\range{\horizon}$ in place of setups variables $\setup_t^i$. $z_{\ell}^i$ is equal to 1 if items $i$ is produced during the periods of $\ell$.

\begin{subequations}\label{eq:extended-CLSP:items}
  \begin{align}
    \min\quad & \rlap{$\ds \sum_{t=1}^{\horizon} \sum_{i\in\REF} \holding_t^i \inventory_t^i$}
    \label{eq:extended-CLSP:items:objective}
    \\
    \st\quad & \ds \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:extended-CLSP:items:inventory-dynamic}
    \\
    & \ds \sum_{i\in\REF} \rate_t^i \quantity_t^i \le \capacity_t && \forall t\in\range{\horizon},
    \label{eq:extended-CLSP:items:capacity}
    \\
    & \ds \rate_t^i \quantity_t^i \le \capacity_t^i \sum_{\ell\subseteq{\range{\horizon}}~|~t\in\ell} z_{\ell}^i && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:extended-CLSP:items:item-capacity}
    \\
    & \ds \sum_{i\in\REF} \sum_{\ell\subseteq\range{\horizon}~|~t\in\ell} z_{\ell}^i \le \nbsetups_t && \forall t\in\range{\horizon},
    \label{eq:extended-CLSP:items:setups}
    \\
    & \ds \sum_{\ell\subseteq\range{\horizon}} z_{\ell}^i \le 1 && \forall i\in\REF,
    \label{eq:extended-CLSP:items:unique-pattern}
    \\
    & \ds z_{\ell}^i \in \NN && \forall t\in\range{\horizon},\ \ell\subseteq\range{\horizon},
    \label{eq:extended-CLSP:items:pattern}
    \\
    & \ds \quantity_t^i,\ \inventory_t^i \ge 0 && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:extended-CLSP:items:positivity}
  \end{align}
\end{subequations}


It is easy to see that the extended formulations~\eqref{eq:extended-CLSP:periods} and \eqref{eq:extended-CLSP:items} also model the CLSP-BS.



\subsubsection{Relaxations of extended formulations}



\begin{prop}\label{prop:extended-relaxation}
The compact formulation~\eqref{eq:CLSP-BS} of CLSP-BS and the extended formulation~\eqref{eq:extended-CLSP:periods} and \eqref{eq:extended-CLSP:items} of CLSP-BS have the same continuous relaxations.
\end{prop}


We will prove proposition~\ref{prop:extended-relaxation} showing that each continuous relaxation of an extended formulation is equal to the continuous relaxation of the compact formulation~\eqref{eq:CLSP-BS} of CLSP-BS.


We start with the relaxation of the extended formulation~\eqref{eq:extended-CLSP:periods} and we need the following lemma.

\begin{lem}\label{lem:cover-vertex}
Let $I\in\NN^*$ and let $N\in\range{I}$.
Let $\bracket{x^i,\ldots,x^I}\in\sqbracket{0,1}^I$ be such that $\sum_{i=1}^I x^i = N$.
Then, there exists $\bracket{y^p}_{p\in{I\choose N}}\in\sqbracket{0,1}^{I\choose N}$ such that:
$$x^i \le \sum_{p\in{I\choose N}~|~i\in p}y^p,\ \forall i\in\range{I}\ \mbox{and}\ \sum_{p\in{I\choose N}}y^p \le 1$$
\end{lem}

\esgil{Preuve du lemme~\ref{lem:cover-vertex} en annexe ou dans le corps?}

Proof of the lemma~\ref{lem:cover-vertex} is given in annexe~\ref{TODO}. We can now prove the equality between the two continuous relaxations.


\begin{proof}
Let $\bracket{\inventory_t^i, \quantity_t^i, y_t^p}$ be a solution of the continuous relaxation of~\eqref{eq:extended-CLSP:periods}.
For $t\in\range{\horizon}$ and $i\in\REF$, we set $\setup_t^i=\sum_{p\in{\REF\choose\nbsetups_t}~|~i\in p} y_t^p$.
Since $\bracket{\inventory_t^i, \quantity_t^i, y_t^p}$ is a solution of the continuous relaxation of~\eqref{eq:extended-CLSP:periods}, we have:
$$
\setup_t^i
= \sum_{p\in{\REF\choose\nbsetups_t}~|~i\in p} y_t^p
\le \sum_{p\in{\REF\choose\nbsetups_t}} y_t^p
\le 1
\qquad \forall t\in\range{\horizon},\forall i\in\REF,
$$
and
$$
\sum_{i\in\REF}\setup_t^i
= \sum_{i\in\REF}\sum_{p\in{\REF\choose\nbsetups_t}~|~i\in p} y_t^p
= \sum_{p\in{\REF\choose\nbsetups_t}} \nbsetups_t\, y_t^p
= \nbsetups_t \sum_{p\in{\REF\choose\nbsetups_t}} y_t^p
\le \nbsetups_t
\qquad \forall t\in\range{\horizon}.
$$
So $\bracket{\inventory_t^i, \quantity_t^i, \setup_t^i}$  is a solution of the continuous relaxation of~\eqref{eq:CLSP-BS} with the same cost as $\bracket{\inventory_t^i, \quantity_t^i, y_t^p}$.


Let $\bracket{\inventory_t^i, \quantity_t^i, \setup_t^i}$ be a solution of the continuous relaxation of~\eqref{eq:CLSP-BS}. Without loss of generality, we can suppose that for each period $t\in\range{\horizon}$, $\sum_{i\in\REF}x_t^i=\nbsetups_t$.
For each period $t\in\range{\horizon}$, according to lemma~\ref{lem:cover-vertex}, there exists
$\bracket{y_t^p}_{p\in{\REF\choose\nbsetups_t}}\in\sqbracket{0,1}^{\REF\choose\nbsetups_t}$ such that
$\setup_t^i \le \sum_{p{\REF\choose\nbsetups_t}~|~i\in p} y_t^p,\ \forall i\in\REF$ and
$\sum_{p\in{\REF\choose\nbsetups_t}}y_t^p \le 1$.
Since $\bracket{\inventory_t^i, \quantity_t^i, \setup_t^i}$ is a solution of the continuous relaxation of~\eqref{eq:CLSP-BS}, we have
$$
\rate_t^i\, \quantity_t^i
\le \setup_t^i\, \capacity_t^i
\le \capacity_t^i\, \sum_{p\in{\REF\choose\nbsetups_t}~|~i\in p} y_t^p
\qquad \forall t\in\range{\horizon},\ \forall i\in\REF.
$$
So $\bracket{\inventory_t^i, \quantity_t^i, y_t^p}$ is a solution of the continuous relaxation of~\eqref{eq:extended-CLSP:periods} with the same cost as $\bracket{\inventory_t^i, \quantity_t^i, y_t^p}$.
\end{proof}



We now prove the equality between the relaxations of the extended formulation~\eqref{eq:extended-CLSP:periods} and the compact formulation~\eqref{eq:CLSP-BS}.


\begin{proof}
Let $\bracket{\inventory_t^i, \quantity_t^i, z_{\ell}^i}$ be a solution of the continuous relaxation of~\eqref{eq:extended-CLSP:items}.
For $t\in\range{\horizon}$ and $i\in\REF$, we set $\setup_t^i=\sum_{\ell\subseteq\range{\horizon}~|~t\in\ell} z_{\ell}^i$.
Since $\bracket{\inventory_t^i, \quantity_t^i, z_{\ell}^i}$ is a solution of the continuous relaxation of~\eqref{eq:extended-CLSP:items}, we have
$$
\setup_t^i
= \sum_{\ell\subseteq\range{\horizon}~|~t\in\ell} z_{\ell}^i
\le \sum_{\ell\subseteq\range{\horizon}} z_{\ell}^i
\le 1
\qquad \forall t\in\range{\horizon},\forall i\in\REF,
$$
and
$$
\sum_{i\in\REF}\setup_t^i
= \sum_{i\in\REF}\sum_{\ell\subseteq\range{\horizon}~|~t\in\ell} z_{\ell}^i
\le \nbsetups_t
\qquad \forall t\in\range{\horizon}.
$$
So $\bracket{\inventory_t^i, \quantity_t^i, \setup_t^i}$  is a solution of the continuous relaxation of the compact formulation~\eqref{eq:CLSP-BS} with the same cost as $\bracket{\inventory_t^i, \quantity_t^i, z_{\ell}^i}$.


Let $\bracket{\inventory_t^i, \quantity_t^i, \setup_t^i}$ be a solution of the continuous relaxation of the compact formulation~\eqref{eq:CLSP-BS}. For each item $i$, we define the sequence $\bracket{\ell_p^i}_p$ of and the associated $z_{\ell_p^i}^i$ as follow:
$$
\begin{aligned}
\ell_1^i       &= \crbracket{t\in\range{\horizon}~|~\setup_t^i>0} \\
z_{\ell_1^i}^i &= \min\crbracket{\setup_t^i~|~t\in\ell_1^i}
\end{aligned}
$$
And for $p\ge1$, while $\ell_p^i\ne\emptyset$,
$$
\begin{aligned}
\ell_{p+1}^i       &= \crbracket{t\in\range{\horizon}~\Big|~\setup_t^i-z_{\ell_p^i}^i>0} \\
z_{\ell_{p+1}^i}^i &= \min\crbracket{\setup_t^i-z_{\ell_p^i}^i~\Big|~t\in\ell_1^i}
\end{aligned}
$$
An example for the definition of the $\bracket{z_{\ell}^i}$ is given on figure~\ref{fig:relaxation-extended-formulation-by-reference}.

\begin{figure}[h]
  \centering
  \includegraphics{main/PDP/images/relaxation_extended-CLSP_items.tikz}
  \caption{Example of definition of the variables $\bracket{z_{\ell}^i}$ for four periods}
  \label{fig:relaxation-extended-formulation-by-reference}
\end{figure}

$\bracket{\ell_p^i}_p$ is finite and strictly decreasing and for every $\ell\notin\bracket{\ell_p^i}_p$, we set $z_{\ell}^i=0$. Then, we have $\setup_t^i = \sum_{\ell\subseteq\range{\horizon}~|~t\in\ell} z_{\ell}^i$ and $\bracket{\inventory_t^i, \quantity_t^i, z_{\ell}^i}$ is a solution of continuous relaxation of the extended formulation~\eqref{eq:extended-CLSP:items}.
\end{proof}



\subsection{Complexité paramétrée: résultats à $\REF$ fixé}

\esgil{TODO}

\begin{itemize}
  \item polynomial à R fixé par programmation dynamique
\end{itemize}
