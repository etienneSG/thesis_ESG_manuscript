\chapter{Deterministic CLSP-BS}
\label{chap:PDP:deterministic}


\section{Introduction}
\label{sec:PDP:deterministic:Motivations}

Fixing the production level for the forthcoming period is a basic decision to be taken when managing an assembly line. Usually, a demand has to be satisfied at due dates but the limited capacity of the line prevents last minute production. On the other hand, too early productions may lead to unnecessary high inventory costs. The challenge of this kind of problems, known as {\em lot-sizing problems} in the operational research community, consists in finding a trade-off between demand satisfaction and holding costs.
When several items can be produced on a same line -- the so-called {\em multi-item} lot-sizing problem --, the capacity of the assembly line is often all the more reduced as the number of distinct items produced over the current period is high. Indeed, changing an item in production stops the line for a moment. This additional capacity reduction is usually modeled by setup costs contributing to the total cost.


As explained in \cref{chap:business-context}, the capacity reduction due to production setups is not modeled by setup costs but instead by an explicit upper bound on the total number of items that can be produced over a period.
Indeed, according to Argon Consulting, many clients aim at minimizing mainly their inventory costs while keeping the number of distinct items produced over each periods below some threshold. This is essentially because, contrary to inventory costs, setup costs are hard to quantify and a maximal number of possible setups per period is easy to estimate.

Since we are interest in mid-term decisions, we consider lot-sizing problem and not scheduling problem which are short-term decisions. Thus the number of setups per period matches exactly with the number of of items produced per period.


To the best of our knowledge, the problem addressed in this chapter is original and such a bound on the number of distinct items produced over a period has not been considered by academics yet, with the notable exception of \cite{Rubaszewski2011} but, contrary to our problem, their bound is an overall bound for the whole horizon and they still consider setup costs.


\medskip

The problem considers an assembly line producing a set $\REF$ of items over $\horizon$ periods. The number of distinct items produced over a period $t$ cannot exceed $\nbsetups_t>0$. There is also an upper bound $\capacity_t$ on the total period production (summed over all items) and an upper bound $\capacity_t^i$ on the production of item $i$ at period $t$. The capacity needed (in time units) to produce one unit of $i$ in period $t$ is $\rate_t^i>0$.

The production of item $i$ must satisfy a demand $\demand_t^i$ at the end of period $t$. When production of a item $i$ is not used to satisfy the demand, it can be stored but incurs a unit holding cost $\holding_t^i>0$ per period. For each item $i$, there is an initial inventory $s_0^i\in\RR_+$.

The goal is to satisfy the whole demand at minimum cost.

Since this problem is a variation of the \emph{Capacitated Lot-Sizing Problem (CLSP)} with a new flexibility constraint expressed as an upper bound on the number of setups, we call it the \emph{Capacitated Lot-Sizing Problem with Bounded number of Setups (CLSP-BS)}.

In many of our applications, holding costs $\holding_t^i$ and internal production times $\rate_t^i$ do not depend on the period and the upper bounds $\capacity_t^i$ and $\capacity_t$ and the maximal number $\nbsetups_t$ of setups do not depend on the item nor the period. Then, we get a simpler version called the \emph{Uniform Capacitated Lot-Sizing Problem with Bounded number of Setups (Uniform CLSP-BS)} where
\begin{equation}
  \holding_t^i=\holding^i,\quad
  \rate_t^i=\rate^i,\quad
  \capacity_t^i=\capacity_t=\capacity,\quad
  \nbsetups_t=\nbsetups.
\end{equation}
This special case captures the essential part and the difficulty of the problem namely the limited flexibility of the assembly line. Most results are true for the CLPS-BS, but we will give counterexample when results only stand for the Uniform CLSP-BS.


\medskip

The following of this chapter presents in \cref{sec:PDP:deterministic:bibliography} a short review of the seminal lot-sizing models, in \cref{sec:PDP:deterministic:model} a formulation of the CLSP-BS as a mixed integer program and in \cref{sec:PDP:deterministic:theoretical-results} results showing the theoretical difficulty of the CLSP-BS.



\section{Bibliography}
\label{sec:PDP:deterministic:bibliography}

While there are many variations of lot-sizing problems in industry, they often minimize a combination of holding costs, production costs and setup costs.
However, production can concern a single or many items and be made on single or several assembly lines.
It can be constrained by capacity or setup time.
Backlog, safety stock, minimal productivity, setup times can be considered.
Review of models are abundant and can be found in \cite{Geunes2014} for single-item models, in \cite{Gicquel2008} for multi-item models or in \cite{Karimi2003} for both models. A proposition of classification of lot-sizing models can be found in~\cite[Chapter 4 and 12]{Pochet2006}.

We do not propose a complete review of the models and only consider some seminal models on a single assembly line.

\medskip

The first model was proposed by \cite{Wagner1958}. It is an uncapacitated, single-item model over $\horizon$ periods. The demand $\demand_t$ is dynamic (\ie time-dependent) and storage is possible between periods. The objective is to minimize holding and setup costs. This model was solved in polynomial time.
Its generalization with production cost (proportional to the quantity produced) depending on period is called \emph{Uncapacitated Economic Lot-Sizing Problem (UELSP)} and was solved in polynomial time \cite{Federgruen1991,Wagelmans1992,Aggarwal1993}.


The \emph{Capacitated Economic Lot-Sizing Problem (CELSP)} is the same model with production capacities depending on time. It is one of the simplest lot-sizing problem which is $\NP$-hard \cite{Florian1980} but have a fully polynomial approximation schemes \cite{vanHoesel2001}.

\medskip

In many applications, a line can produce more than one item. These problem are said to be \emph{multi-item}. Two sub-classes are often consider big bucket models and small bucket models.
In big bucket models, several items can be produced during a period.
The \emph{Capacitated Lot-Sizing Problem (CLSP)} is a natural multi-item extension of the CELSP and therefore is $\NP$-complete.
In small bucket model, only one item per period can be produced. The problem is said to be \emph{continuous} when production can be a fractional part of capacity and \emph{discrete} when production must be done at full capacity. The \emph{Capacitated Setup Lot-sizing Problem (CSLP)} is an example of continuous small bucket model and \emph{Discrete Lot sizing and Scheduling Problem (DLSP)} an example of discrete one (see \cite{Gicquel2008} for the complete description of these model).

\medskip

Another way of modeling flexibility and without using setup costs is constraining on the capacity lost due to setups like in the Kellogg's case in \cite[Chapter 4]{Pochet2006}. Some lot-sizing and scheduling problems (see for example \cite{Guimaraes2014}) also model sequence dependent capacity reduction but keep setup costs.
\esgil{Revoir la formulation de ce dernier paragraphe: les phrases sont bancales. Rappeler que la flexibilité a souvent été mise dans les coût de setup.}


%Lot-sizing problems are a well-studied topic, with many variations (deterministic/stochastic, single/multi item, capacitated/uncapacitated, etc.). Recent surveys have been proposed: see \cite{Gicquel2008,quadt2008capacitated} for the deterministic version and \cite{Mula2006,Aloulou2014,Diaz-Madronero2014} for the stochastic version.

\medskip


According to Argon, capacity reduction constraints are not easy to parametrize in practice at mid-term level since they rely on scheduling which are short-term decisions. Thus, in the follow-up to this chapter, we propose a new model for the flexibility introducing a bounded number of setups per period and show the $\NP$-completeness and the theoretical difficulties of the model.



\section{Model formulation}
\label{sec:PDP:deterministic:model}


In this section, we introduce a mixed integer program which model the problem.
We introduce the following decision variables. The quantity of item $i$ produced at period $t$ is denoted by $\quantity_t^i$ and the inventory at the end of the period is denoted by $\inventory_t^i$. We also introduce a binary variable $\setup_t^i$ which takes the value 1 if the item $i$ is produced during period $t$.

The CLSP-BS can be written as
\begin{subequations}\label{eq:CLSP-BS}
  \begin{align+}
    \min\quad & \rlap{$\ds \sum_{t=1}^{\horizon} \sum_{i\in\REF} \holding_t^i \inventory_t^i$}
    \label{eq:CLSP-BS:objective}
    \\
    \st\quad & \ds \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:CLSP-BS:inventory-dynamic}
    \\
    & \ds \sum_{i\in\REF} \rate_t^i \quantity_t^i \le \capacity_t && \forall t\in\range{\horizon},
    \label{eq:CLSP-BS:capacity}
    \\
    & \ds \rate_t^i \quantity_t^i \le \capacity_t^i \setup_t^i && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:CLSP-BS:big-M}
    \\
    & \ds \sum_{i\in\REF} \setup_t^i \le \nbsetups_t && \forall t\in\range{\horizon},
    \label{eq:CLSP-BS:setups}
    \\
    & \ds \setup_t^i \in \crbracket{0,1} && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:CLSP-BS:boolean}
    \\
    & \ds \quantity_t^i,\ \inventory_t^i \ge 0 && \forall t\in\range{\horizon},\ \forall i\in\REF.
    \label{eq:CLSP-BS:positivity}
  \end{align+}
\end{subequations}

Objective~\eqref{eq:CLSP-BS:objective} minimize the holding costs.
Constraint~\eqref{eq:CLSP-BS:inventory-dynamic} is the inventory dynamic.
Capacity of the assembly line is ensured by constraint~\eqref{eq:CLSP-BS:capacity}.
Constraint~\eqref{eq:CLSP-BS:big-M} is both a ``big-M'' constraint and a capacity of the production of a single item.
Constraint~\eqref{eq:CLSP-BS:setups} limits the number of setups at each period.
Note that without loss of generality, we can suppose that $\capacity_t^i \le \capacity_t$ for each period $t$ and each item $i$.


\medskip

In the uniform case, holding costs $\holding_t^i$ and internal production times $\rate_t^i$ of item $i$ do not depend on time and is equal to $\rate^i$ and production capacities $\capacity_t^i$ and $\capacity_t$ depend neither on time nor on item and is equal to $\capacity>0$.
Then, we normalize production variables setting $\widehat{\quantity}_t^i=\frac{\rate^i\quantity_t^i}{\capacity}$ and replace accordingly the other variables and parameters setting $\widehat{\inventory}_t^i=\frac{\rate^i\inventory_t^i}{\capacity}$, $\widehat{\demand}_t^i=\frac{\rate^i\demand_t^i}{\capacity}$ and $\widehat{\holding}^i=\frac{\capacity\holding^i}{\rate^i}$.
For the purpose of notation, the hat are omitted and the optimization problem can be written as

\begin{subequations}\label{eq:Uniform-CLSP-BS}
  \begin{align+}
    \min\quad & \rlap{$\ds \sum_{t=1}^{\horizon} \sum_{i\in\REF} \holding^i \inventory_t^i$}
    \label{eq:Uniform-CLSP-BS:objective}
    \\
    \st\quad & \ds \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:Uniform-CLSP-BS:stock-dynamics}
    \\
    & \ds \sum_{i\in\REF} \quantity_t^i \le 1 && \forall t\in\range{\horizon},
    \label{eq:Uniform-CLSP-BS:capacity}
    \\
    & \ds \quantity_t^i \le \setup_t^i && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:Uniform-CLSP-BS:item-capacity}
    \\
    & \ds \sum_{i\in\REF} \setup_t^i \le \nbsetups && \forall t\in\range{\horizon},
    \label{eq:Uniform-CLSP-BS:setups}
    \\
    & \ds \setup_t^i \in \crbracket{0,1} && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:Uniform-CLSP-BS:boolean}
    \\
    & \ds \quantity_t^i,\ \inventory_t^i \ge 0 && \forall t\in\range{\horizon},\ \forall i\in\REF.
    \label{eq:Uniform-CLSP-BS:positivity}
  \end{align+}
\end{subequations}


\section{Theoretical results}
\label{sec:PDP:deterministic:theoretical-results}

In this section, we show that our problem is theoretically hard and that classical methods lead to dead end. After showing the $\NP$-completeness in \cref{sec:PDP:deterministic:theoretical-results:NP-completeness}, we show that the number $\nbsetups$ of setups is not captured by the continuous relaxation (\cref{sec:PDP:deterministic:theoretical-results:continuous-relaxation}) nor valid inequality (\cref{sec:PDP:deterministic:theoretical-results:valid-inequality}) nor natural extended formulations (\cref{sec:PDP:deterministic:theoretical-results:extended-formulations}).


\subsection{$\NP$-completeness}
\label{sec:PDP:deterministic:theoretical-results:NP-completeness}

For any fixed values of the $\holding_t^i$'s, the CLSP-BS is $\NP$-hard.

\begin{thm}
  Deciding if there is a solution of the Uniform CLSP-BS is $\NP$-complete in the strong sense.
\end{thm}



Reducing 3-partition problem to the Uniform CLSP-BS, we show that deciding if there is a solution of the Uniform CLSP-BS is $\NP$-complete. We remind that the 3-partition problem consists in whether a given multiset of integers can be partitioned into triples that all have the same sum. This problem is known to be $\NP$-complete in the strong sense (see~\cite{Garey1979}).



\begin{proof}
Let $\crbracket{a_1,\ldots,a_{3m}}$ be an instance of the 3-partition problem.
We reduce polynomially this problem to an instance of the Uniform CLSP-BS.
Without loss of generality, we can assume that sum of the $a_i$'s is positive.
We set
\begin{equation}
  \REF=\range[1]{3m}
  ,\quad
  \horizon=m
  ,\quad
  \nbsetups=3
  ,\quad
  \demand_t^i
  =\left\{
  \begin{array}{ll}
  \frac{m\,a_i}{\sum_{j=1}^{3m}a_j} & \mbox{if}\ t=\horizon,
  \\
  0 & \mbox{otherwise,}\end{array}
  \right.
  \quad
  \inventory_0^i=0.
\end{equation}
Thus, we have a solution for the 3-partition problem if and only if there is a solution to the Uniform CLSP-BS with these parameters. The conclusion follow from the fact that the 3-partition problem is $\NP$-complete in the strong sense.
\end{proof}


%Since Uniform CLSP-BS is a special case of CLSP-BS, CLSP is also $\NP$-complete.
Complexity of the following cases is still an open problem.
\begin{question}
Complexity of uncapacitated Uniform CLSP-BS with $\nbsetups=1$ is an open question.
\end{question}

The complexity of the cases with $\nbsetups=2$ are also challenging questions.




\subsection{Relaxations}
\label{sec:PDP:deterministic:theoretical-results:continuous-relaxation}

\subsubsection{Continuous relaxation}

The goal of this section is to show that unless the capacity production of one item is smaller than the production of the line at each period, continuous relaxation is not a good method to get bound on the CLSP-BS


%\begin{prop}\label{prop:relaxation-independant-N:uniform}
%Ecrire la proposition \cref{prop:relaxation-independant-N} dans le cas uniform.
%\end{prop}

%\esgil{Dire qu'en fait on va la montrer avec des hypothèse plus faible.}

%\begin{prop}\label{prop:relaxation-independant-N}
%If for each item $i$, $\capacity_t^i\ge\capacity_t$ for all period $t\in\range{\horizon}$ and if for each period $t\in\range{\horizon}$, $\nbsetups_t=0\implies\capacity_t=0$, then the continuous relaxation of CLSP-BS does not depend on $\nbsetups$.
%\end{prop}

\begin{prop}\label{prop:relaxation-independant-N}
Assume $\nbsetups_t>0$ for all period $t$.
If $\capacity_t^i\ge\capacity_t$ for all item $i$ and all period $t$, then the continuous relaxation of CLSP-BS does not depend on $\nbsetups_t$.
\end{prop}

The immediate corollary of this proposition is that the continuous relaxation of Uniform CLSP-BS never depends on $\nbsetups$.


The following example shows that the conclusion of the proposition does not hold when we relax the condition $\capacity_t^i\ge\capacity_t$ for all $i,t$. Consider the following instance of CLSP-BS:
\begin{equation}
\begin{split}
  \REF=\crbracket{1,2}
  ,\quad
  \horizon=2
  ,\quad
  \nbsetups_t=1
  ,\quad
  \capacity_t=2
  ,\quad
  \capacity_t^i=1
  ,
\\
  \rate_t^i=1
  ,\quad
  \demand_t^i
  =\left\{
  \begin{array}{ll}
  0 & \mbox{if}\ t=1,
  \\
  1 & \mbox{if}\ t=2,\end{array}
  \right.
  \quad
  \holding_t^i=\holding
  ,\quad
  \inventory_0^i=0.
\end{split}
\end{equation}
%two periods and two items where the holding costs at the end of the first period are $h$ for the two items and 0 at the end of the second period. The assembly line's capacity is $\capacity_t=2$ at each period and the capacity per item at each period is $\capacity_t^i=1$. The number of setups per period is $\nbsetups_t=1$ and the demand is null for the first period and 1 for each reference at the second period. All others parameters are unitary.
Then, the optimal solution of the continuous relaxation of formulation~\eqref{eq:CLSP-BS} with these parameters is $h$ whereas the optimal solution of the continuous relaxation of the formulation~\eqref{eq:CLSP-BS} without the flexibility constraint~\eqref{eq:CLSP-BS:setups} is 0.

\esgil{Add figure representing the example}

We now prove \cref{prop:relaxation-independant-N}.

\begin{proof}[Proof of \cref{prop:relaxation-independant-N}]
Consider an instance of CLSP-BS where $\capacity_t^i\ge\capacity_t$ for all period $t$ and all item $i$.
Let $v$ denote the optimal value of the continuous relaxation of formulation~\eqref{eq:CLSP-BS} and $\widehat{v}$ the optimal value of the continuous relaxation of formulation~\eqref{eq:CLSP-BS} without the flexibility constraint~\eqref{eq:CLSP-BS:setups}.
Obviously, we have $v \ge \widehat{v}$.
Let us show that $v \le \widehat{v}$.

Let $\bracket{\widehat{\setup}_t^i, \widehat{\quantity}_t^i, \widehat{\inventory}_t^i}_{t,i}$ be a feasible solution of the continuous relaxation of formulation~\eqref{eq:CLSP-BS} without the flexibility constraint~\eqref{eq:CLSP-BS:setups}.
For each period $t$ and each item $i$, we define
\begin{equation}
  \setup_t^i=
  \left\{
  \begin{array}{ll}
  \frac{\rate_t^i\,\widehat{\quantity}_t^i}{\capacity_t^i} & \mbox{if}\ \capacity_t^i>0,
  \\
  0 & \mbox{if}\ \capacity_t^i=0,
  \end{array}
  \right.
  \quad
  \quantity_t^i=\widehat{\quantity}_t^i
  ,\quad
  \inventory_t^i=\widehat{\inventory}_t^i
\end{equation}
We now prove that $\bracket{\setup_t^i, \quantity_t^i, \inventory_t^i}_{t,i}$ is a feasible solution of the continuous relaxation of formulation~\eqref{eq:CLSP-BS}.

By definition of $\quantity_t^i$ and $\inventory_t^i$, constraints~\eqref{eq:CLSP-BS:inventory-dynamic} and \eqref{eq:CLSP-BS:capacity} of are satisfied.

If $\capacity_t^i>0$, by definition of $\setup_t^i$ and $\quantity_t^i$ constraint~\eqref{eq:CLSP-BS:big-M} of formulation~\eqref{eq:CLSP-BS} is satisfied.
If $\capacity_t^i=0$, since $\bracket{\widehat{\setup}_t^i, \widehat{\quantity}_t^i, \widehat{\inventory}_t^i}_{t,i}$ is feasible, we have $\widehat{\quantity}_t^i=0$ and constraint~\eqref{eq:CLSP-BS:big-M} is satisfied. 

We have
\begin{subequations}
\begin{align}
\capacity_t\sum_{i\in\REF}\setup_t^i
&\le
\sum_{i\in\REF}\capacity_t^i\setup_t^i
&& \mbox{($\capacity_t^i\ge\capacity_t$)}
\\
&\le
\sum_{i\in\REF}\rate_t^i\widehat{\quantity}_t^i
&& \mbox{(definition of $\setup_t^i$)}
\\
&\le
\capacity_t.
&& \mbox{(feasibility of $\bracket{\widehat{\setup}_t^i, \widehat{\quantity}_t^i, \widehat{\inventory}_t^i}_{t,i}$)}
\end{align}
\end{subequations}
If $\capacity_t>0$, then $\sum_{i\in\REF}\setup_t^i\le 1\le\nbsetups_t$.
Otherwise, if $\capacity_t=0$, since $\bracket{\widehat{\setup}_t^i, \widehat{\quantity}_t^i, \widehat{\inventory}_t^i}_{t,i}$ is feasible, we have $\quantity_t^i=0$ for each item $i$ and by definition of $\setup_t^i$, we have $\sum_{i\in\REF}\setup_t^i=0\le\nbsetups_t$.
In both cases, constraint~\eqref{eq:CLSP-BS:setups} is satisfied.

If $\capacity_t^i>0$, we have $\setup_t^i=\frac{\rate_t^i\widehat{\quantity}_t^i}{\capacity_t^i}\le\widehat{\setup}_t^i\le 1$.
Otherwise, if $\capacity_t^i=0$, we have by definition $\setup_t^i=0$.
In both cases, continuous relaxation of constraint~\eqref{eq:CLSP-BS:boolean} is satisfied.

By definition of $\quantity_t^i$ and $\inventory_t^i$, constraints~\eqref{eq:CLSP-BS:positivity} is satisfied.

Thus, we get a feasible solution of the continuous relaxation of formulation~\eqref{eq:CLSP-BS}. So $v \le \widehat{v}$.
\end{proof}



% \subsubsection{Lagrangian relaxations}


% The two Lagrangian relaxations described in this section are quite the same for the CLSP-BS and the Uniform CLSP-BS. Thus, for the sake of simplicity, we write them for the Uniform CLSP-BS.


% A first option consists in dualizing the capacity constraint~\eqref{eq:Uniform-CLSP-BS:item-capacity}. Then, for all $\lambda = \bracket{\lambda_t^i}_{t\in\range{\horizon},\,i\in\REF}\ge 0$, we have:
% \begin{equation}
%   \begin{aligned}
%     \cG_1\bracket{\lambda} &= 
%     \left\{
%       \begin{array}{rll}
%         \min & \multicolumn{2}{l}{\sum_{t=1}^{\horizon} \sum_{i\in\REF} \sqbracket{ \holding^i\inventory_t^i + \lambda_t^i \bracket{\quantity_t^i - \setup_t^i} } } \\
%         \st & \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i & \forall t,r \\
%         & \sum_{i\in\REF} \quantity_t^i \le 1 & \forall t \\
%         & \sum_{i\in\REF} \setup_t^i \le \nbsetups & \forall t \\
%         & \setup_t^i \in \crbracket{0,1} & \forall t,r \\
%         & \quantity_t^i,\ \inventory_t^i \ge 0 & \forall t,r
%       \end{array}
%     \right.
%     \\
%     &= 
%     \left\{
%       \begin{array}{rll}
%         \min & \multicolumn{2}{l}{\sum_{t=1}^{\horizon} \sum_{i\in\REF} \bracket{ \holding^i\inventory_t^i + \lambda_t^i \quantity_t^i } } \\
%         \st & \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i & \forall t,r \\
%         & \sum_{i\in\REF} \quantity_t^i \le 1 & \forall t \\
%         & \quantity_t^i,\ \inventory_t^i \ge 0 & \forall t,r
%       \end{array}
%     \right.
%     +
%     \left\{
%       \begin{array}{rll}
%         \max & \multicolumn{2}{l}{\sum_{t=1}^{\horizon} \sum_{i\in\REF} \lambda_t^i\setup_t^i } \\
%         \st & \sum_{i\in\REF} \setup_t^i \le \nbsetups & \forall t \\
%         & \setup_t^i \in \crbracket{0,1} & \forall t,r
%       \end{array}
%     \right.
%     \\
%     \cG_1\bracket{\lambda} &= 
%     \left\{
%       \begin{array}{rll}
%         \min & \multicolumn{2}{l}{\sum_{t=1}^{\horizon} \sum_{i\in\REF} \bracket{ \holding^i \inventory_t^i + \lambda_t^i \quantity_t^i } } \\
%         \st & \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i & \forall t,r \\
%         & \sum_{i\in\REF} \quantity_t^i \le 1 & \forall t \\
%         & \quantity_t^i,\ \inventory_t^i \ge 0 & \forall t,r
%       \end{array}
%     \right.
%     +
%     \sum_{t=1}^{\horizon}
%     \left\{
%       \begin{array}{rll}
%         \max & \multicolumn{2}{l}{\sum_{i\in\REF} \lambda_t^i \setup_t^i } \\
%         \st & \sum_{i\in\REF} \setup_t^i \le \nbsetups \\
%         & \setup_t^i \in \crbracket{0,1} & \forall r
%       \end{array}
%     \right.\label{eq:Lagrangian:capacity:max-setups}
%   \end{aligned}
% \end{equation}

% The minimization program of the equation~\eqref{eq:Lagrangian:capacity:max-setups} is a linear program with only continuous variables. So it can be solved in polynomial time. For each $t\in\range{\horizon}$, the maximization program can be solve in polynomial time with a greedy algorithm by sorting the $\lambda_t^i$ in decreasing order. Thus, this Lagrangian relaxation is easy to solve and moreover, it yield an integer solution.

% \medskip

% A second option consists in using the pseudo-norm
% \begin{equation}
% \begin{array}{lrcl}
%   \norm{\ .\ }_0 :& \RR^n & \longrightarrow & \RR_+ \\
%   & x & \longmapsto & \sum_{i=1}^n \findi{\crbracket{x_i \ne 0}}
% \end{array}
% \end{equation}
% which returns the size of the support of the vector $x$ and in dualizing the flexibility constraint~\eqref{eq:Uniform-CLSP-BS:setups}. Then, for all $\mu=\bracket{\mu_t}_{t\in\range{\horizon}}\ge 0$, we have:
% \begin{equation}
%   \begin{aligned}
%     \cG_2\bracket{\mu} &= 
%     \left\{
%       \begin{array}{rll}
%         \min & \multicolumn{2}{l}{\sum_{t=1}^{\horizon} \sqbracket{ \sum_{i\in\REF} \holding^i \inventory_t^i + \mu_t \bracket{ \norm{\bracket{\quantity_t^i}_{i\in\REF}}_0 - \nbsetups} } } \\
%         \st & \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i & \forall t,r \\
%         & \sum_{i\in\REF} \quantity_t^i \le 1 & \forall t \\
%         & \quantity_t^i \le 1 & \forall t,r \\
%         & \quantity_t^i,\ \inventory_t^i \ge 0 & \forall t,r
%       \end{array}
%     \right.
%   \end{aligned}
%   \label{eq:Lagrangian:setups}
% \end{equation}

% Because of $\norm{\ .\ }_0$ being a pseudo-norm, it is common to replace it with $\norm{\ .\ }_1$ and in this case, the equation~\eqref{eq:Lagrangian:setups} can easily be turned into a linear program with continuous variables.


% \esgil{Intérêt de cette partie ?}


\subsection{Valid inequalities}
\label{sec:PDP:deterministic:theoretical-results:valid-inequality}

Some valid inequalities exists in literature. However, they do not provide relaxation depending on the number $\nbsetups_t$ of setups.

A classical valid inequality relies on the absence of backorder and is given by \cref{prop:valid-inequality:no-backorder}. The statement can be found in \cite{Geunes2014} for the Capacitated Economic Lot-sizing Problem (CELSP).
\begin{prop}\label{prop:valid-inequality:no-backorder}
  For all period $t$ and all item $i$, we define $K_t^i = \max_{t'\in\range{t}}\frac{\capacity_{t'}^i}{\rate_{t'}^i}$ and assume that it is positive.
  Then,
  \begin{equation}\label{eq:valid-inequality:no-backorder}
    \sum_{t'=1}^{t}\setup_{t'}^i
    \ge
    \left\lceil
    \frac{1}{K_t^i} \bracket{ \sum_{t'=1}^{t}\demand_{t'}^i-\inventory_0^i }
    \right\rceil
  \end{equation}
  is a valid inequality.
\end{prop}


\begin{proof}
  At period $t$, initial inventory and cumulative production must at least cover the cumulative past demand. So
  \begin{equation}
    \inventory_0^i + \sum_{t'=1}^{t} \quantity_t^i \ge \sum_{t'=1}^{t}\demand_{t'}^i
  \end{equation}
  Constraint~\eqref{eq:CLSP-BS:big-M} gives
  \begin{equation}
    \quantity_{t'}^i \le \frac{\setup_{t'}^i\capacity_{t'}^i}{\rate_{t'}^i} \le \setup_{t'}^i K_t^i
  \end{equation}
  and then
  \begin{equation}
    \sum_{t'=1}^t\setup_{t'}^i \ge \frac{1}{K_t^i}\sum_{t'=1}^t\demand_{t'}^i-\inventory_0^i.
  \end{equation}
  The conclusion comes from the integrity of $\sum_{t'=1}^t\setup_{t'}^i$.
\end{proof}

Note that we can be more precise when writing valid inequality~\eqref{eq:valid-inequality:no-backorder}. It is easy to show that we can remove from the sum $\sum_{t'=1}^{t}\setup_{t'}^i$ every index $t'$ such that $\capacity_{t'}^i=0$.



\esgil{TODO: Prove that the continuous relaxation does not depend on $\nbsetups_t$}


\subsection{Extended formulations}
\label{sec:PDP:deterministic:theoretical-results:extended-formulations}


Two natural extended formulations come in mind. Unfortunately, their continuous relaxations are equal to the one of the formulation~\eqref{eq:CLSP-BS} as we will show in this section.



\subsubsection{Model formulations}

The first extended formulation is given by the mixed integer program~\eqref{eq:extended-CLSP:periods}.
%For each period $t$, we introduce a set of indexes $\crbracket{p\in{\REF\choose\nbsetups_t}}$ which represents every choice of $\nbsetups_t$ items among $\REF$.
We introduce binary variables $y_t^p$ defined for each period $t\in\range{\horizon}$ and each choice $p\in{\REF\choose\nbsetups_t}$ of items.
% in place of setups variables $\setup_t^i$.
$y_t^p$ is equal to 1 if items in $p$ are allowed to be produced at periods $t$.

\begin{subequations}\label{eq:extended-CLSP:periods}
  \begin{align+}
    \min\quad & \rlap{$\ds \sum_{t=1}^{\horizon} \sum_{i\in\REF} \holding_t^i \inventory_t^i$}
    \label{eq:extended-CLSP:periods:objective}
    \\
    \st\quad & \ds \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:extended-CLSP:periods:inventory-dynamic}
    \\
    & \ds \sum_{i\in\REF} \rate_t^i \quantity_t^i \le \capacity_t && \forall t\in\range{\horizon},
    \label{eq:extended-CLSP:periods:capacity}
    \\
    & \ds \rate_t^i \quantity_t^i \le \capacity_t^i \sum_{p\in{\REF\choose\nbsetups_t}~|~i\in p} y_t^p && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:extended-CLSP:periods:item-capacity}
    \\
    & \ds \sum_{p\in{\REF\choose\nbsetups_t}} y_t^p \le 1 && \forall t\in\range{\horizon},
    \label{eq:extended-CLSP:periods:unique-pattern}
    \\
    & \ds y_t^p \in \NN && \forall t\in\range{\horizon},\ p\in{\REF\choose\nbsetups_t},
    \label{eq:extended-CLSP:periods:pattern-def}
    \\
    & \ds \quantity_t^i,\ \inventory_t^i \ge 0 && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:extended-CLSP:periods:positivity}
  \end{align+}
\end{subequations}


The second extended formulation is given by the mixed integer program~\eqref{eq:extended-CLSP:items}.
%For each item $i$, we introduce a set of indexes $\crbracket{\ell\subseteq\range{\horizon}}$ which represents every choice of periods when item $i$ is produced.
We introduce binary variables $z_{\ell}^i$ defined for each item $i\in\REF$ and each choice $\ell\subseteq\range{\horizon}$ of periods.
% in place of setups variables $\setup_t^i$.
$z_{\ell}^i$ is equal to 1 if item $i$ is produced during the periods of $\ell$.


\begin{subequations}\label{eq:extended-CLSP:items}
  \begin{align+}
    \min\quad & \rlap{$\ds \sum_{t=1}^{\horizon} \sum_{i\in\REF} \holding_t^i \inventory_t^i$}
    \label{eq:extended-CLSP:items:objective}
    \\
    \st\quad & \ds \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:extended-CLSP:items:inventory-dynamic}
    \\
    & \ds \sum_{i\in\REF} \rate_t^i \quantity_t^i \le \capacity_t && \forall t\in\range{\horizon},
    \label{eq:extended-CLSP:items:capacity}
    \\
    & \ds \rate_t^i \quantity_t^i \le \capacity_t^i \sum_{\ell\subseteq{\range{\horizon}}~|~t\in\ell} z_{\ell}^i && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:extended-CLSP:items:item-capacity}
    \\
    & \ds \sum_{i\in\REF} \sum_{\ell\subseteq\range{\horizon}~|~t\in\ell} z_{\ell}^i \le \nbsetups_t && \forall t\in\range{\horizon},
    \label{eq:extended-CLSP:items:setups}
    \\
    & \ds \sum_{\ell\subseteq\range{\horizon}} z_{\ell}^i \le 1 && \forall i\in\REF,
    \label{eq:extended-CLSP:items:unique-pattern}
    \\
    & \ds z_{\ell}^i \in \NN && \forall t\in\range{\horizon},\ \ell\subseteq\range{\horizon},
    \label{eq:extended-CLSP:items:pattern}
    \\
    & \ds \quantity_t^i,\ \inventory_t^i \ge 0 && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \label{eq:extended-CLSP:items:positivity}
  \end{align+}
\end{subequations}


It is easy to see that the extended formulations~\eqref{eq:extended-CLSP:periods} and \eqref{eq:extended-CLSP:items} also model the CLSP-BS.



\subsubsection{Relaxations of extended formulation~\eqref{eq:extended-CLSP:periods}}



\begin{prop}\label{prop:extended-relaxation:periods}
The compact formulation~\eqref{eq:CLSP-BS} of CLSP-BS and the extended formulation~\eqref{eq:extended-CLSP:periods} of CLSP-BS have the same continuous relaxations.
\end{prop}

In order to prove \cref{prop:extended-relaxation:periods}, we need the following lemma.

\begin{lem}\label{lem:cover-vertex}
Let $I\in\NN^*$ and let $N\in\range{I}$.
Let $\bracket{x_i,\ldots,x_I}\in\sqbracket{0,1}^I$ be such that $\sum_{i=1}^I x_i = N$.
Then, there exists $\bracket{y_p}_{p\in{I\choose N}}\in\sqbracket{0,1}^{I\choose N}$ such that
\begin{equation}
  \sum_{p\in{I\choose N}}y_p = 1
  \ \mbox{and for each $i\in\range{I}$,}\ 
  x_i \le \sum_{p\in{I\choose N}~|~i\in p}y_p
\end{equation}
\end{lem}


\begin{rmq}
In case $N=2$, \cref{lem:cover-vertex} gives the following result on a graph. If $\bracket{x_i}_i$ represents the weighting of the vertexes of a complete graph meeting the hypothesis of the lemma, then there exists a weighting $\bracket{y_p}_p$ of the edges such that the sum of the weights of the edges is lower or equal to 1 and for each vertex, the sum of the weights of incident edges is greater or equal to the weight of the vertex.
\end{rmq}



\begin{proof}[Proof of \cref{lem:cover-vertex}]
Let $I\in\NN^*$ and let $N\in\range{I}$.
Let $\bracket{x_1,\ldots,x_I}\in\sqbracket{0,1}^I$ be such that $\sum_{i=1}^I x_i = N$.
To prove the lemma, it is sufficient to prove that the linear program~\eqref{eq:cover-vertex:primal} is feasible and that its optimum is equal to 1.
\begin{subequations}\label{eq:cover-vertex:primal}
  \begin{align+}
    \min\quad & \rlap{$\ds \sum_{p\in{I\choose N}} y_p$}
    \label{eq:cover-vertex:primal:objective}
    \\
    \st\quad & \ds \sum_{p\in{I\choose N}~|~i\in p} y_p \ge x_i && \forall i\in\range{I}
    \label{eq:cover-vertex:primal:cover}
    \\
    & \ds y_p \ge 0 && \forall p\in{I\choose N}
    \label{eq:cover-vertex:primal:positive}
  \end{align+}
\end{subequations}

So it is sufficient to prove that the dual~\eqref{eq:cover-vertex:dual} of program~\eqref{eq:cover-vertex:primal} is feasible and that its optimum $v_D$ is equal to 1.

\begin{subequations}\label{eq:cover-vertex:dual}
  \begin{align+}
    \max\quad & \rlap{$\ds \sum_{i=1}^I \lambda_i x_i$}
    \label{eq:cover-vertex:dual:objective}
    \\
    \st\quad & \ds \sum_{i\in p} \lambda_i \le 1 && \forall p\in{I\choose N}
    \label{eq:cover-vertex:dual:cover}
    \\
    & \ds \lambda_i \ge 0 && \forall i\in\range{I}
    \label{eq:cover-vertex:dual:positive}
  \end{align+}
\end{subequations}

First, note that $v_D\ge 1$. Indeed, $\bracket{\lambda_1,\ldots,\lambda_I}=\bracket{\frac{1}{N},\ldots,\frac{1}{N}}$ is feasible and provides the value $1$ to the objective function. Let us show that $v_D\le 1$.

We assume without loss of generality that $x_1\ge\ldots\ge x_I$.
Let $\lambda^*$ be an optimal solution of program~\eqref{eq:cover-vertex:dual}.
It is easy to show that we can require
\begin{equation}
  \lambda_1^*\ge\ldots\ge\lambda_I^*
  \ \mbox{and}\ 
  \sum_{i=1}^N\lambda_i^*=1.
\end{equation}
Moreover, since $\sum_{i\in p}\lambda_i^*$ is maximal when $p=[N]$, we can also require that
\begin{equation}
  \lambda_N^*=\ldots=\lambda_I^*.
\end{equation}
Finally, among all $\lambda^*$ satisfying these requirements, we choose one with maximal $\lambda_1^*$, which exists by compactness. We deal with two cases.

\medskip

{\bf First case:} \emph{$\lambda_1^*<1$.}
Suppose first for a contradiction that $\lambda_2^*>\lambda_I^*$.
Then, denote $\ell$ the largest index such that $\lambda_{\ell}^*=\lambda_2^*$.
The fact that $\lambda_N^*=\ldots=\lambda_I^*$ implies that $\ell<N$.
Increasing $\lambda_1^*$ by a small $\varepsilon=\lambda_{\ell}^*-\lambda^{{\ell+1}*}>0$ and decreasing $\lambda_{\ell}^*$ by the same amount provides a new optimal solution (feasible because $\sum_{i\in p}\lambda^{i*}$ is maximal when $p=[N]$), with a larger $\lambda_1$.
This is in contradiction with the definition of $\lambda^*$.
We have thus $\lambda_2^*=\ldots=\lambda_I^*$ and $v_D$ is upper bounded by the optimal value of
\begin{subequations}\label{eq:cover-vertex:dual:relaxation}
  \begin{align+}
    \max\quad & \rlap{$\ds \lambda_1x_1+\lambda_2\sum_{r=2}^I x_i$}
    \\
    \st\quad & \lambda_1 + \bracket{N-1} \lambda_2 = 1
    \\
    & \lambda_2 - \lambda_1 + z = 0
    \\
    & \lambda_1,\ \lambda_2,\ z\ge 0
  \end{align+}
\end{subequations}
The variable $z$ is introduced so that the program is in standard form.
Let $(\tilde\lambda_1,\tilde\lambda_2,\tilde z)$ be an optimal basic solution.
If the optimal basis is $\crbracket{\lambda_1,\lambda_2}$, then $\tilde z=0$ and we have $\tilde\lambda_1=\tilde\lambda_2=1/N$, which gives a value $1$ to the objective function of problem~\eqref{eq:cover-vertex:dual:relaxation}.
If the optimal basis is $\crbracket{\lambda_1,z}$, then $\tilde\lambda_2=0$ and we have $\tilde\lambda_1=1$, which gives a value $x_1$ to the objective function of problem~\eqref{eq:cover-vertex:dual:relaxation}.
The basis $\crbracket{\lambda_2,z}$ being not feasible, we get $v_D\leq\max\bracket{x_1,1}=1$.

\medskip

{\bf Second case:} \emph{$\lambda_1^*=1$.}
We have obviously $\lambda_2^*=\ldots=\lambda_I^*=0$, and thus $v_D=x_1\le 1$.

\medskip

In both cases, $v_D\le 1$, as required. Hence $v_D = 1$ which conclude the proof.
\end{proof}




\begin{proof}[Proof of \cref{prop:extended-relaxation:periods}]
Let $\bracket{\inventory_t^i, \quantity_t^i, y_t^p}_{t,i,p}$ be a solution of the continuous relaxation of~\eqref{eq:extended-CLSP:periods}.
For each period $t$ and each item $i$, we set
\begin{equation}
  \setup_t^i=\sum_{p\in{\REF\choose\nbsetups_t}~|~i\in p} y_t^p.
\end{equation}
Since $\bracket{\inventory_t^i, \quantity_t^i, y_t^p}_{t,i,p}$ is a feasible solution of the continuous relaxation of~\eqref{eq:extended-CLSP:periods}, we have
\begin{equation}
\setup_t^i
= \sum_{p\in{\REF\choose\nbsetups_t}~|~i\in p} y_t^p
\le \sum_{p\in{\REF\choose\nbsetups_t}} y_t^p
\le 1
\qquad \forall t\in\range{\horizon},\ \forall i\in\REF,
\end{equation}
and
\begin{equation}
\sum_{i\in\REF}\setup_t^i
= \sum_{i\in\REF}\sum_{p\in{\REF\choose\nbsetups_t}~|~i\in p} y_t^p
= \sum_{p\in{\REF\choose\nbsetups_t}} \nbsetups_t\, y_t^p
= \nbsetups_t \sum_{p\in{\REF\choose\nbsetups_t}} y_t^p
\le \nbsetups_t
\qquad \forall t\in\range{\horizon}.
\end{equation}
So $\bracket{\inventory_t^i, \quantity_t^i, \setup_t^i}_{t,i}$  is a solution of the continuous relaxation of~\eqref{eq:CLSP-BS} with the same cost as $\bracket{\inventory_t^i, \quantity_t^i, y_t^p}$.


Let $\bracket{\inventory_t^i, \quantity_t^i, \setup_t^i}_{t,i}$ be a solution of the continuous relaxation of~\eqref{eq:CLSP-BS}.
Without loss of generality, we can suppose that for each period $t$, we have $\sum_{i\in\REF}x_t^i=\nbsetups_t$.
For each period $t$, according to \cref{lem:cover-vertex}, there exists
$\bracket{y_t^p}_{p\in{\REF\choose\nbsetups_t}}\in\sqbracket{0,1}^{\REF\choose\nbsetups_t}$ such that
\begin{equation}
  \sum_{p\in{\REF\choose\nbsetups_t}}y_t^p = 1
  \ \mbox{and for each $i\in\range{I}$,}\ 
  \setup_t^i \le \sum_{p{\REF\choose\nbsetups_t}~|~i\in p} y_t^p.
\end{equation}
Since $\bracket{\inventory_t^i, \quantity_t^i, \setup_t^i}_{t,i}$ is a solution of the continuous relaxation of~\eqref{eq:CLSP-BS}, we have
\begin{equation}
\rate_t^i\, \quantity_t^i
\le \setup_t^i\, \capacity_t^i
\le \capacity_t^i\, \sum_{p\in{\REF\choose\nbsetups_t}~|~i\in p} y_t^p
\qquad \forall t\in\range{\horizon},\ \forall i\in\REF.
\end{equation}
So $\bracket{\inventory_t^i, \quantity_t^i, y_t^p}_{t,i,p}$ is a solution of the continuous relaxation of~\eqref{eq:extended-CLSP:periods} with the same cost as $\bracket{\inventory_t^i, \quantity_t^i, \setup_t^i}_{t,i}$.
\end{proof}



\subsubsection{Relaxations of extended formulation~\eqref{eq:extended-CLSP:items}}



\begin{prop}\label{prop:extended-relaxation:items}
The compact formulation~\eqref{eq:CLSP-BS} of CLSP-BS and the extended formulation~\eqref{eq:extended-CLSP:items} of CLSP-BS have the same continuous relaxations.
\end{prop}



\begin{proof}
Let $\bracket{\inventory_t^i, \quantity_t^i, z_{\ell}^i}_{t,i,\ell}$ be a solution of the continuous relaxation of~\eqref{eq:extended-CLSP:items}.
For each period $t$ and each item $i$, we set
\begin{equation}
  \setup_t^i=\sum_{\ell\subseteq\range{\horizon}~|~t\in\ell} z_{\ell}^i.
\end{equation}
Since $\bracket{\inventory_t^i, \quantity_t^i, z_{\ell}^i}_{t,i,\ell}$ is a feasible solution of the continuous relaxation of~\eqref{eq:extended-CLSP:items}, we have
\begin{equation}
\setup_t^i
= \sum_{\ell\subseteq\range{\horizon}~|~t\in\ell} z_{\ell}^i
\le \sum_{\ell\subseteq\range{\horizon}} z_{\ell}^i
\le 1
\qquad \forall t\in\range{\horizon},\forall i\in\REF,
\end{equation}
and
\begin{equation}
\sum_{i\in\REF}\setup_t^i
= \sum_{i\in\REF}\sum_{\ell\subseteq\range{\horizon}~|~t\in\ell} z_{\ell}^i
\le \nbsetups_t
\qquad \forall t\in\range{\horizon}.
\end{equation}
So $\bracket{\inventory_t^i, \quantity_t^i, \setup_t^i}_{t,i}$  is a solution of the continuous relaxation of the compact formulation~\eqref{eq:CLSP-BS} with the same cost as $\bracket{\inventory_t^i, \quantity_t^i, z_{\ell}^i}_{t,i,\ell}$.


Let $\bracket{\inventory_t^i, \quantity_t^i, \setup_t^i}_{t,i}$ be a solution of the continuous relaxation of the compact formulation~\eqref{eq:CLSP-BS}. For each item $i$, we define the sequence $\bracket{\ell_p^i}_p$ of subsets of $\range{\horizon}$ and the associated sequence $\bracket{z_{\ell_p^i}^i}_p$ of integers as follow
\begin{equation}
  \begin{aligned}
  \ell_1^i       &= \crbracket{t\in\range{\horizon}~\Big|~\setup_t^i>0} \\
  z_{\ell_1^i}^i &= \min\crbracket{\setup_t^i~\Big|~t\in\ell_1^i}
  \end{aligned}
\end{equation}
and for $p\ge1$, while $\ell_p^i\ne\emptyset$,
\begin{equation}
  \begin{aligned}
  \ell_{p+1}^i       &= \crbracket{t\in\range{\horizon}~\Big|~\setup_t^i-z_{\ell_p^i}^i>0} \\
  z_{\ell_{p+1}^i}^i &= \min\crbracket{\setup_t^i-z_{\ell_p^i}^i~\Big|~t\in\ell_p^i}
  \end{aligned}
\end{equation}
An example for the definition of the $\bracket{z_{\ell}^i}_p$ is given on \cref{fig:relaxation-extended-formulation-by-reference}.

\begin{figure}[h]
  \centering
  \includegraphics{main/PDP/images/relaxation_extended-CLSP_items.tikz}
  \caption{Example of definition of the variables $\bracket{z_{\ell}^i}_p$ for four periods}
  \label{fig:relaxation-extended-formulation-by-reference}
\end{figure}

Sequence $\bracket{\ell_p^i}_p$ is finite and strictly decreasing and for each $\ell\notin\bracket{\ell_p^i}_p$, we set $z_{\ell}^i=0$. Then, we have $\setup_t^i = \sum_{\ell\subseteq\range{\horizon}~|~t\in\ell} z_{\ell}^i$ and $\bracket{\inventory_t^i, \quantity_t^i, z_{\ell}^i}_{t,i,\ell}$ is a solution of continuous relaxation of the extended formulation~\eqref{eq:extended-CLSP:items}.
\end{proof}




\section{Solving the CLSP-BS}
\label{sec:PDP:deterministic:solving}

Even if the CLSP-BS is theoretically hard, we are able to solve it for the data provided by clients of Argon Consulting. The numerical results will be discuss in \cref{chap:PDP:numerical-experiments}.


\subsection{Off-the-shelf solver}


C++11 has been chosen for the implementation of the mixed integer program of compact formulation~\eqref{eq:CLSP-BS} and Gurobi 6.5.1~\cite{gurobi} was used to solve the model on a PC with Intel(R) Core(TM) i7-3770 CPU @ 3.40GHz and 8Go RAM. These characteristics correspond to a standard computer in consultancy firm.

In the data provided by clients, we have at most 30 items and 13 periods. So the number of binary variables is always lower to 400 in deterministic case. Thus, we succeed in getting the optimal solution in less than 20 seconds.


\subsection{Using the pseudo-norm $\norm{\ .\ }_0$}


An other option consists in using the pseudo-norm
\begin{equation}
\begin{array}{lccl}
  \norm{\ .\ }_0 :& \RR^n & \longrightarrow & \RR_+
  \\
  & x & \longmapsto & \sum_{i=1}^n \findi{\crbracket{x_i \ne 0}}
\end{array}
\end{equation}
which returns the size of the support of the vector $x$ and in dualizing the flexibility constraint~\eqref{eq:Uniform-CLSP-BS:setups}. Then, for all $\mu=\bracket{\mu_t}_{t\in\range{\horizon}}\ge 0$, we have:
\begin{equation}\label{eq:Lagrangian:setups}
  \begin{aligned}
    \min\quad & \rlap{$\ds \sum_{t=1}^{\horizon} \sqbracket{ \sum_{i\in\REF} \holding^i \inventory_t^i + \mu_t \bracket{ \norm{\bracket{\quantity_t^i}_{i\in\REF}}_0 - \nbsetups} }$}
    \\
    \st\quad & \ds \inventory_t^i = \inventory_{t-1}^i + \quantity_t^i - \demand_t^i && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \\
    & \ds \sum_{i\in\REF} \quantity_t^i \le 1 && \forall t\in\range{\horizon},
    \\
    & \ds \quantity_t^i \le 1 && \forall t\in\range{\horizon},\ \forall i\in\REF,
    \\
    & \ds \quantity_t^i,\ \inventory_t^i \ge 0 && \forall t\in\range{\horizon},\ \forall i\in\REF,
  \end{aligned}
\end{equation}

Because of $\norm{\ .\ }_0$ being a pseudo-norm, it is common to replace it with $\norm{\ .\ }_1$ and in this case, the equation~\eqref{eq:Lagrangian:setups} can easily be turned into a linear program with continuous variables.



\subsection{Dynamic programming with fixed $\REF$}

\esgil{TODO}

\begin{itemize}
  \item polynomial à $\REF$ fixé par programmation dynamique
\end{itemize}
